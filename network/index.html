<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络编程快速入门 | 🔞の領域</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/image/favicon.png">
    <meta name="description" content="　我们立足于美利坚合众国, 针对年满18周岁非大陆全球华人开发, 受北美法律保护.　 　　　　　　　　　　　　　未經授權禁止复制或建立镜像. 　　　　　　　　　　　　We are based in the United States of America, for over 18 years of age non-mainland Chinese open world, by the North American legal protection. Unauthorized reproduction prohibited or create mirror.">
    <link rel="preload" href="/assets/css/0.styles.eda1073d.css" as="style"><link rel="preload" href="/assets/js/app.5aa78949.js" as="script"><link rel="preload" href="/assets/js/2.db8a1bd9.js" as="script"><link rel="preload" href="/assets/js/26.79a3a1f7.js" as="script"><link rel="prefetch" href="/assets/js/10.cb22b5cc.js"><link rel="prefetch" href="/assets/js/11.7fc433a5.js"><link rel="prefetch" href="/assets/js/12.26e9cadb.js"><link rel="prefetch" href="/assets/js/13.1258d0f5.js"><link rel="prefetch" href="/assets/js/14.99ec5e93.js"><link rel="prefetch" href="/assets/js/15.5e075e9b.js"><link rel="prefetch" href="/assets/js/16.3ae89ebf.js"><link rel="prefetch" href="/assets/js/17.a0578cc8.js"><link rel="prefetch" href="/assets/js/18.57573e35.js"><link rel="prefetch" href="/assets/js/19.1921cef9.js"><link rel="prefetch" href="/assets/js/20.21e6a458.js"><link rel="prefetch" href="/assets/js/21.85d787bf.js"><link rel="prefetch" href="/assets/js/22.463f771e.js"><link rel="prefetch" href="/assets/js/23.a24c9494.js"><link rel="prefetch" href="/assets/js/24.4e9dffaf.js"><link rel="prefetch" href="/assets/js/25.48966cca.js"><link rel="prefetch" href="/assets/js/27.d86ae0b6.js"><link rel="prefetch" href="/assets/js/28.3085660e.js"><link rel="prefetch" href="/assets/js/29.b25e9aa3.js"><link rel="prefetch" href="/assets/js/3.bfe9edf0.js"><link rel="prefetch" href="/assets/js/30.32eb4625.js"><link rel="prefetch" href="/assets/js/31.c255a7cd.js"><link rel="prefetch" href="/assets/js/32.d4a5e1b3.js"><link rel="prefetch" href="/assets/js/33.939416f6.js"><link rel="prefetch" href="/assets/js/34.1527656e.js"><link rel="prefetch" href="/assets/js/35.31254244.js"><link rel="prefetch" href="/assets/js/36.4c9eea64.js"><link rel="prefetch" href="/assets/js/37.dcba8e22.js"><link rel="prefetch" href="/assets/js/38.660f4f18.js"><link rel="prefetch" href="/assets/js/39.36808ac4.js"><link rel="prefetch" href="/assets/js/4.721e6361.js"><link rel="prefetch" href="/assets/js/40.5e3d825d.js"><link rel="prefetch" href="/assets/js/41.8bc35558.js"><link rel="prefetch" href="/assets/js/42.3d9ee979.js"><link rel="prefetch" href="/assets/js/43.d8a9355a.js"><link rel="prefetch" href="/assets/js/44.3b96fdab.js"><link rel="prefetch" href="/assets/js/45.5a397a89.js"><link rel="prefetch" href="/assets/js/46.2c015a12.js"><link rel="prefetch" href="/assets/js/47.cb620ad3.js"><link rel="prefetch" href="/assets/js/48.63e77fd7.js"><link rel="prefetch" href="/assets/js/49.3a1743f4.js"><link rel="prefetch" href="/assets/js/5.9c8aa7de.js"><link rel="prefetch" href="/assets/js/50.858e22ae.js"><link rel="prefetch" href="/assets/js/51.d5ea8da3.js"><link rel="prefetch" href="/assets/js/6.cfcb9227.js"><link rel="prefetch" href="/assets/js/7.7ef2cd09.js"><link rel="prefetch" href="/assets/js/8.8cae79fc.js"><link rel="prefetch" href="/assets/js/9.116ce45e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eda1073d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">🔞の領域</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/cs/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/network/" class="nav-link router-link-exact-active router-link-active">
  网络编程
</a></div><div class="nav-item"><a href="/server/" class="nav-link">
  后端开发
</a></div><div class="nav-item"><a href="/web/" class="nav-link">
  前端开发
</a></div><div class="nav-item"><a href="/opensource/" class="nav-link">
  开源软件
</a></div><div class="nav-item"><a href="/note/" class="nav-link">
  读书笔记
</a></div><div class="nav-item"><a href="/manual/" class="nav-link">
  开发手册
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <a href="https://github.com/louistin/blog.liteman.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/cs/" class="nav-link">
  计算机基础
</a></div><div class="nav-item"><a href="/network/" class="nav-link router-link-exact-active router-link-active">
  网络编程
</a></div><div class="nav-item"><a href="/server/" class="nav-link">
  后端开发
</a></div><div class="nav-item"><a href="/web/" class="nav-link">
  前端开发
</a></div><div class="nav-item"><a href="/opensource/" class="nav-link">
  开源软件
</a></div><div class="nav-item"><a href="/note/" class="nav-link">
  读书笔记
</a></div><div class="nav-item"><a href="/manual/" class="nav-link">
  开发手册
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <a href="https://github.com/louistin/blog.liteman.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>TCP/IP</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/network/tcp-ip/TCP 协议.html" class="sidebar-link">TCP 协议</a></li><li><a href="/network/tcp-ip/UDP 协议.html" class="sidebar-link">UDP 协议</a></li><li><a href="/network/tcp-ip/DNS 协议.html" class="sidebar-link">DNS 协议</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Socket API</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>IPC</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="网络编程快速入门"><a href="#网络编程快速入门" class="header-anchor">#</a> 网络编程快速入门</h1> <h2 id="快速理解网络通信协议"><a href="#快速理解网络通信协议" class="header-anchor">#</a> 快速理解网络通信协议</h2> <ul><li><p>五层模型</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>实体层
    光缆, 电缆等, 传输 <span class="token number">0</span> <span class="token number">1</span>

链接层
    以太网协议
        解决局域网点对点通信
        每帧<span class="token punctuation">(</span>Frame<span class="token punctuation">)</span>: Head<span class="token punctuation">(</span><span class="token number">18</span>/22 byte<span class="token punctuation">)</span> + Data<span class="token punctuation">(</span><span class="token number">46</span> - <span class="token number">1500</span> byte<span class="token punctuation">)</span>
    MAC 地址
        绑定在网卡上, 定位网卡和数据包路径
        <span class="token number">48</span>位, 通常表示为 <span class="token number">12</span> 个十六进制数 00-B0-D0-86-BB-F7
    广播
        ARP 协议
        以太网发包是向本<span class="token punctuation">(</span>子<span class="token punctuation">)</span>网络内所有计算机发送, 让每台计算机自己判断是否为接收方<span class="token punctuation">(</span>根据
          每包标头MAC地址<span class="token punctuation">)</span>

网络层 <span class="token punctuation">(</span>主机到主机<span class="token punctuation">)</span>
    IP 协议
        连接多个局域网, 地址协议, 不保证数据完整性
        定位计算机所在的子网络, 为每台计算机分配 IP 地址
        网络地址 <span class="token operator">=</span> 网络号 + 主机号 <span class="token number">192.168</span>.1 + .34
        子网掩码 <span class="token operator">=</span> 网络部分全为 <span class="token number">1</span> + 主机部分全为 <span class="token number">0</span>. 判断 IP 地址的网络部分与主机部分
    IP 数据包
        Head<span class="token punctuation">(</span><span class="token number">20</span> <span class="token number">60</span> byte<span class="token punctuation">)</span> + Data<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token operator">=</span> <span class="token number">65535</span> byte<span class="token punctuation">)</span>
        Head 包括版本, 长度, IP地址等
        一个 IP 数据包在以太网中有可能会分包
    ARP 协议
        得到同一子网络中目标主机 IP
        为什么需要 ARP 协议?
            IP 协议传输数据必须知道 IP 地址和 MAC 地址, IP 地址一般已知
            根据 IP 地址获取 MAC 地址的方法:
                两台主机位于非同一个子网络, 需要将数据包传给子网络连接处的
                  网关<span class="token punctuation">(</span>Gateway<span class="token punctuation">)</span>, 让其处理
                两台主机位于同一个子网络, ARP 协议发出数据包<span class="token punctuation">(</span>包含在以太网数据帧中<span class="token punctuation">)</span>, 其
                  中包含目标主机 IP, 目标 MAC 填写 FF:FF:FF:FF:FF:FF, 表示为广播
                  地址. 子网络中每一台主机都会收到数据包, 取出 IP 地址后, 与自身 IP
                  比较, 相同则回复, 告知自己的 MAC 地址, 否则就丢弃.

传输层 <span class="token punctuation">(</span>端到端<span class="token punctuation">)</span>
    端口 Port
        每一个使用网卡的程序的编号
        <span class="token number">0</span> - <span class="token number">1023</span> - <span class="token number">65535</span>
        主机 + 端口 <span class="token operator">=</span> 套接字 Socket
    UDP 协议
        Head<span class="token punctuation">(</span><span class="token number">8</span> byte<span class="token punctuation">)</span> + Data<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token operator">=</span> <span class="token number">65527</span> byte<span class="token punctuation">)</span>
        Head 发出端口 + 接收端口
        简单, 可靠性差
    TCP 协议
        数据包长度没有限制, 但为了保证网络效率, 通常不会超过 IP 数据包 Data 长度
        保证数据通信的完整性和可靠性, 防止丢包

应用层
    直接面对客户

Head + Head + Head + Data
以太网  IP     TCP    应用层数据
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div></li> <li><p>IP 地址</p> <p><strong>IP 地址分类</strong><br></p> <img src="/image/network/readme_ip_address_001.webp" alt="IP 地址分类"> <img src="/image/network/readme_ip_address_002.webp" alt="IP 地址分类"> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>网络地址 <span class="token operator">=</span> Network ID + Host ID
          <span class="token number">192.168</span>.1 + .34
A B C 类地址为单播地址, 用于一对一通信
D 类地址用于多播
E 类地址保留

<span class="token number">0.0</span>.0.0
    不是真正意义上的 IP 地址, 表示所有不清楚的主机和目的网络
<span class="token number">255.255</span>.255.255
    限制广播地址, 本网段内<span class="token punctuation">(</span>同一广播域<span class="token punctuation">)</span>所有主机. 这个地址不能被路由器转发
<span class="token number">127.0</span>.0.1
    本机地址, 别名 localhost<span class="token punctuation">(</span>但并不局限于 <span class="token number">127.0</span>.0.1, 例如还有 IPV6<span class="token punctuation">)</span>
    所有 <span class="token number">127</span>.x.x.x 都属于回环地址<span class="token punctuation">(</span>发往该类地址的数据包都应该被 loop back<span class="token punctuation">)</span>
    用途: 回环测试 程序测试<span class="token punctuation">(</span>Web 服务器绑定<span class="token punctuation">)</span> DDos 攻击防御
<span class="token number">224.0</span>.0.1
    组播地址, 从 <span class="token number">224.0</span>.0.0 - <span class="token number">239.255</span>.255.255 都是这样的地址. <span class="token number">224.0</span>.0.1 特指所有主
      机, <span class="token number">223.0</span>.0.2 特指所有路由器.
<span class="token number">169.254</span>.x.x
    主机使用 DHCP 时, 当 DHCP 服务故障时, Windows 系统会为你分配一个这样的地址
<span class="token number">10</span>.x.x.x <span class="token number">172.16</span>.x.x ~ <span class="token number">172.31</span>.x.x <span class="token number">192.168</span>.x.x
    私有地址. 接入 Internet 时, 要使用 NAT, 将私有地址翻译成共用地址

<span class="token number">127.0</span>.0.1 是一个回环地址, 并不表示<span class="token string">&quot;本机&quot;</span>, <span class="token number">0.0</span>.0.0 真正表示<span class="token string">&quot;本网络中的本机&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li> <li><p>集线器 交换机 路由器</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>集线器 Hub
    物理层
    通过网线直接传送数据
    不能分辨数据目的地, 只能广播

交换机
    数据链路层
    根据 MAC 地址, 实现任意两台计算机之间的数据传输

路由器
    网络层
    通过 IP 寻址
    TCP/IP 协议
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>电脑联网</p> <ul><li>联网条件
<ul><li>本机 IP, 子网掩码, 网关 IP 地址, DNS IP 地址</li></ul></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>静态 IP 地址
    手动配置

动态 IP 地址
    DHCP 协议动态获取
        DHCP 协议是建立在 UDP 协议之上的应用层协议
        Head + Head + Head + Data
        以太网  IP     UDP    DHCP数据
            以太网标头: 本机 MAC 地址, 接收方<span class="token punctuation">(</span>DHCP 服务器<span class="token punctuation">)</span> MAC 地址<span class="token punctuation">(</span>未知 广播
                FF-FF-FF-FF-FF-FF<span class="token punctuation">)</span>
            IP 标头: 发出方 IP 地址<span class="token punctuation">(</span><span class="token number">0.0</span>.0.0 未知<span class="token punctuation">)</span>, 接收方 IP 地址<span class="token punctuation">(</span>未知
                <span class="token number">255.255</span>.255.255<span class="token punctuation">)</span>
            UDP 标头: 发出方端口<span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span>, 接收方端口<span class="token punctuation">(</span><span class="token number">67</span><span class="token punctuation">)</span>
        子网中每台计算机都收到数据包, DHCP 服务器根据<span class="token punctuation">(</span><span class="token number">0.0</span>.0.0 <span class="token number">255.255</span>.255.255<span class="token punctuation">)</span>判断
          自己为接收方, 其他丢弃
        DHCP 服务器分配好 IP 后, 发送 DHCP 响应包, 以太网标头为双方 MAC 地址, IP 标
          头地址为 DHCP 服务器地址和 <span class="token number">255.255</span>.255.255<span class="token punctuation">(</span>接收方<span class="token punctuation">)</span>, 发送方端口<span class="token punctuation">(</span><span class="token number">67</span><span class="token punctuation">)</span>, 接收
          方端口<span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span>, 分配的 IP 地址等参数在 Data 中
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p>互联网协议</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># www.google.com 的访问流程</span>
<span class="token number">1</span>. 浏览器地址输入 www.google.com
<span class="token number">2</span>. 将地址发送到 DNS Server <span class="token number">8.8</span>.8.8, 响应 Google IP 为 <span class="token number">172.194</span>.72.105
<span class="token number">3</span>. 使用子网掩码 <span class="token number">255.255</span>.255.0 AND Google IP, 得到 <span class="token number">172.194</span>.72.0
    使用子网掩码 <span class="token number">255.255</span>.255.0 AND 本机 IP, 得到 <span class="token number">192.168</span>.1.0
    两者不相等, 说明 Google 不在本机子网上, 数据包必须经过网关 <span class="token number">192.168</span>.1.1 转发, 也即
      是接收方的 MAC 地址将是网关 MAC 地址
<span class="token number">4</span>. HTTP 内容 <span class="token number">4960</span> 字节
    GET / HTTP/1.1
    Host: <span class="token punctuation">[</span>url<span class="token operator">=</span>http://www.google.com<span class="token punctuation">]</span>www.google.com<span class="token punctuation">[</span>/url<span class="token punctuation">]</span>
    Connection: keep-alive
    User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>Windows NT <span class="token number">6.1</span><span class="token punctuation">)</span> <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
    Accept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>
    Accept-Encoding: gzip,deflate,sdch
    Accept-Language: zh-CN,zh<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>
    Accept-Charset: GBK,utf-8<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.7</span>,*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.3</span>
    Cookie: <span class="token punctuation">..</span>. <span class="token punctuation">..</span>.
<span class="token number">5</span>. Google HTTP 端口为 <span class="token number">80</span>, 本机端口<span class="token punctuation">(</span><span class="token number">1024</span>-65535<span class="token punctuation">)</span>, 为 <span class="token number">1080</span>
    TCP 数据包长度 <span class="token number">4980</span> <span class="token operator">=</span> Head<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> + HTTP Data<span class="token punctuation">(</span><span class="token number">4940</span><span class="token punctuation">)</span>
<span class="token number">6</span>. IP 数据包设置双方 IP 地址<span class="token punctuation">(</span><span class="token number">172.194</span>.72.105 <span class="token number">192.168</span>.1.11<span class="token punctuation">)</span>
    IP 数据包长度 <span class="token number">5000</span> <span class="token operator">=</span> Head<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> + TCP Data<span class="token punctuation">(</span><span class="token number">4980</span><span class="token punctuation">)</span>
<span class="token number">7</span>. 以太网数据包设置双方 MAC 地址, 接收方为网关 <span class="token number">192.168</span>.1.1 的 MAC 地址
   以太网数据包长度 <span class="token number">1500</span> <span class="token operator">=</span> Head<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> + IP Data<span class="token punctuation">(</span><span class="token number">1480</span><span class="token punctuation">)</span>
    IP 数据包分割为 <span class="token number">1500</span> + <span class="token number">1500</span> + <span class="token number">1500</span> + <span class="token number">560</span>
<span class="token number">8</span>. 多个网关转发, Google 服务器根据 IP Head 序号, 拼包, 解析数据, 处理, 响应
<span class="token number">9</span>. 完成一次网络通信
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li> <li><p>Ping</p> <p><strong>ICMP 协议</strong><br> <img src="/image/network/readme_icmp_001.webp" alt="ICMP 协议"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>基于 ICMP 协议工作, 探测本机与网络中另一台主机之间是否可达的命令
    ICMP 协议, Internet 控制报文协议, 基于 IP 协议
    ICMP 协议会要求目标主机在收到消息后, 必须返回 ICMP 应答消息给源主机. 如果源主机在一
      定时间内收到目标主机应答, 则表明两台主机间网络是可达的.

<span class="token number">1</span>. 主机 A <span class="token punctuation">(</span><span class="token number">192.168</span>.0.1<span class="token punctuation">)</span> 测试与主机 B <span class="token punctuation">(</span><span class="token number">192.168</span>.0.2<span class="token punctuation">)</span>, 执行 <span class="token function">ping</span> <span class="token number">192.168</span>.0.2
<span class="token number">2</span>. <span class="token function">ping</span> 命令在主机 A 上构建 ICMP 请求数据包, 然后 ICMP 协议将这个数据包以及目标 IP
    等信息交给 IP 层协议
<span class="token number">3</span>. IP 层协议的达消息后, 将源地址, 目标地址, 再加上一些其他控制信息, 构建 IP 数据包
<span class="token number">4</span>. IP 数据包构建完成后, 需要加上 MAC 地址. 因此还需要通过 ARP 映射表找出目标 IP 所对应
    的 MAC 地址, 拿到目标 MAC 地址后, 和本机 MAC 一起交给数据链路层, 组装成一个数据帧,
    将其传送出去
<span class="token number">5</span>. 目标主机收到数据帧之后, 首先检查其目标 MAC 是否为本机, 确认后检查数据帧, 将 IP 数据
    包取出, 交给本机 IP 层, 然后经 IP 层检查完后, 再将 ICMP 数据包取出来交给 ICMP 协
    议处理. 处理完毕后, 构建 ICMP 应答数据包, 会发给源主机
<span class="token number">6</span>. 在一定时间内, 源主机收到应答包, 说明网络可达. 没收到则说明不可达. 除检测可达外, 还可
    以利用应答时间和发起时间差, 计算数据包延迟耗时

ICMP 协议分类
    查询报文类型
        <span class="token function">ping</span> 查询 子网掩码查询 时间戳查询
    差错报文类型
        目标不可达 超时 参数问题 重定向

Traceroute 指令
    利用 ICMP 的差错报文可以实现遍历到数据包传输路径上的所有路由器.
    每经过一个路由器, TTL 值 -1, 当 TTL <span class="token operator">=</span> <span class="token number">0</span> 时, 路由器会将数据包丢弃, 然后产生一个错
      误类型的 ICMP 数据包会发给源主机, 这时候源主机就拿到了第一个路由节点的 IP 和相关
      信息. 如此反复通过改变 TTL 值, 可以拿到源主机到目标主机间所有路由器信息.
    数据包到达目标主机后, 可以通过源主机设置一个不可达的目标端口号, 那么当这个数据包到达目
      标主机时, 目标主机会产生一个<span class="token string">&quot;端口不可达&quot;</span>的错误 ICMP 报文返回给源主机
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><ul><li><p>参考资料</p> <p><a href="https://cloud.tencent.com/developer/article/1004762" target="_blank" rel="noopener noreferrer">从 Tranceroute 看网络问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul></li> <li><p>P2P</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>局域网 LAN

网络地址转换<span class="token punctuation">(</span>NAT<span class="token punctuation">)</span>
    内网通过网关访问外网
    地址转换表
        源 IP:Port  映射后 IP:Port
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <hr> <h2 id="socket"><a href="#socket" class="header-anchor">#</a> Socket</h2> <ul><li><p>Socket 创建</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Socket 其实是使用 <span class="token operator">&lt;</span>peer_addr:peer_port, local_addr:local_port<span class="token operator">&gt;</span> 四元组来区别不同
  socket 实例.
一个客户端连接情况下, 有三个 socket
    服务端负责监听 ServerSocket <span class="token operator">&lt;</span>*:*, *:987<span class="token operator"><span class="token file-descriptor important">7</span>&gt;</span> 可接受任何客户端和本地任何 IP
    accept 返回 socket <span class="token operator">&lt;</span><span class="token number">127.0</span>.0.1:client_port, <span class="token number">127.0</span>.0.1:987<span class="token operator"><span class="token file-descriptor important">7</span>&gt;</span>
    客户端 socket <span class="token operator">&lt;</span>server_ip:9877, <span class="token number">127.0</span>.0.1:client_port<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>Socket 读写</p> <p><strong>Socket 读写</strong><br> <img src="/image/network/readme_socket_rdwr_001.gif" alt="Socket 读写"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">read</span> buffer, <span class="token function">write</span> buffer
    调用系统 API 对 socket 进行写操作是将数据拷贝到套接字对象的 <span class="token function">write</span> buffer, 内核网
      络模块会有专门的单独线程负责将 <span class="token function">write</span> buffer 的数据拷贝到网卡, 网卡再将数据发送
    读数据操作是调用系统 API 将 <span class="token builtin class-name">read</span> buffer 的数据拷贝到用户程序内存中来

阻塞
    <span class="token function">write</span> buffer 空间有限, 如果应用程序写数据太快, 空间写满了, 写操作就会阻塞, 直到这
      个空间有足够的位置空出来. NIO 写操作不阻塞, 通过返回值确定写入量, 未写入的数据用户
      程序会缓存起来, 后续再写入.
    <span class="token builtin class-name">read</span> buffer 也可能内容为空, 此时读操作也会阻塞, 直到 <span class="token builtin class-name">read</span> buffer 中有足够的内容.
      NIO 不会阻塞, 有多少读多少, 不够的后续继续读.
ACK
    写缓冲数据拷贝到网卡后, 并不会立刻删除, 需要等待对方 ACK 过来后才会删除. 网络不好使,
      写缓冲也会满
包头
    数据每经过一层, 就回添加上一层对应的包头
速率
    读缓冲满后, 网卡收到的消息会丢弃, 也并不会发 ACK. 此时 TCP 协议会调整动态窗口,
      UDP 则会彻底丢失
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li></ul> <hr> <h2 id="tcp-udp"><a href="#tcp-udp" class="header-anchor">#</a> TCP UDP</h2> <ul><li><p>TCP 协议作用</p> <ul><li>以太网协议解决局域网点对点通信</li> <li>IP 协议可以连接多个局域网</li> <li>TCP 协议保证数据通信的完整性和可靠性, 防止丢包</li></ul></li> <li><p>TCP 数据包大小</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>以太网负载payload <span class="token number">1500</span> 字节
    IP 标头 <span class="token operator">&gt;</span><span class="token operator">=</span> <span class="token number">20</span> 字节, payload <span class="token operator">&lt;</span><span class="token operator">=</span> <span class="token number">1480</span> 字节
        TCP 头 <span class="token operator">&gt;</span><span class="token operator">=</span> <span class="token number">20</span> 字节, payload <span class="token operator">&lt;</span><span class="token operator">=</span> <span class="token number">1460</span> 字节

TCP IP 协议往往有额外头信息, TCP 实际 payload ~<span class="token operator">=</span> <span class="token number">1400</span> 字节
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>TCP 数据包编号 SEQ</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>第一个包是随机数, 例如 <span class="token number">1</span> 号包, 假设负载长度为 <span class="token number">100</span> 字节, 则下一包编号就是 <span class="token number">1</span> + <span class="token number">100</span> <span class="token operator">=</span> <span class="token number">101</span>
每个包都可以得到两个编号: 自己的编号, 下一个包的编号. 接收方可以根据编号将其顺序还原
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>TCP 数据包的组装</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>TCP 不提供机制表示原始数据大小, 由应用层协议规定
OS 根据 TCP 数据包中的端口, 将组装好的数据转给对应的应用
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>ACK 和慢启动</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>TCP 协议为做到效率和可靠性统一, 慢启动机制在开始时会发送的较慢, 根据丢包调整速率.

内核中 TCP_INIT_CWND 设定, 开始时, 发送方一次性发送 <span class="token number">10</span> 个数据包, 即发送窗口为 <span class="token number">10</span>, 然
  后停下等待接收方确认, 再继续发送. 默认情况下, 接收方每收到两个 TCP 数据包, 发送一个确
  认消息, 即 ACK <span class="token punctuation">(</span>acknowledgement<span class="token punctuation">)</span>.

ACK 携带信息:
    期待要收到的下一个数据包编号
    接收方的接收窗口剩余容量
发送方根据 ACK 信息, 推测接收方接收速率, 做出发送速率调整, 即发送窗口调整.

TCP 是双向通信, 双方都需要发送 ACK, 两方窗口可以不一样
ACK 很小, 通常与数据合并在同一个数据包中发送
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>数据可靠性保证</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>每个数据包都带有下一个数据包编号, 如果下一个没收到, 则 ACK 不会变化, 会一直显示为期待值
接收方未受到期待值包, 即使收到后面的包, ACK 也不会变
发送方发现收到连续三个重复 ACK, 或超时还未收到任何 ACK, 即确认丢包, 会再次发送这个包
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>TCP 三次握手 四次挥手</p> <p><strong>三次握手 四次挥手</strong><br> <img src="/image/network/readme_tcp001.webp" alt="TCP 三次握手 四次挥手"></p> <p><strong>三次握手</strong><br> <img src="/image/network/readme_tcp_connect001.gif" alt="TCP 三次握手状态"> <img src="/image/network/readme_tcp_connect002.gif" alt="TCP 三次握手状态"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>半打开状态:
    syn_sent
    syn_rcvd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>数据传输</strong><br> <img src="/image/network/readme_tcp_data001.gif" alt="TCP 数据传输"> <img src="/image/network/readme_tcp_data002.gif" alt="TCP 数据传输"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>TCP 连接是双工的, 无论哪方都可以主动发起数据传输, 同时也都需要对方回复 ACK 确认
数据发送与接收双方需要协商合适的发送与接收速率, 即 TCP 窗口大小
接收方可以在接收到多个数据包后, 批量 ACK
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>四次挥手</strong><br> <img src="/image/network/readme_tcp_disconnect001.gif" alt="TCP 四次挥手状态"> <img src="/image/network/readme_tcp_disconnect002.gif" alt="TCP 四次挥手状态" style="width:40%;"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>半关闭状态<span class="token punctuation">(</span>主动关闭方发起关闭后, 并没有立刻关闭<span class="token punctuation">)</span>
time_wait 状态
    主动关闭的一方在回复完对方的挥手<span class="token punctuation">(</span>ACK<span class="token punctuation">)</span>后, 进入的长期状态<span class="token punctuation">(</span>标准时间为 4min, 可调<span class="token punctuation">)</span>,
      然后才会进入 closed 状态, 释放套接字资源
    作用是重传最后一个 ACK 报文, 确保对方收到. 如果对方未收到, 重发 FIN 报文, 需要响应
    在此间, 网络上的残存报文传到时, 会被立刻丢弃
    <span class="token number">4</span> min <span class="token operator">=</span> <span class="token number">2</span> MSL <span class="token punctuation">(</span>最长报文寿命<span class="token punctuation">)</span>, 确保残留文件彻底消失, 不影响当前端口再次利用
    四次挥手有可能中间两次合并为三次挥手, 主动关闭方从 fin_wait_1 直接进入 time_wait
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>TCP 建立连接并初始化目标
    初始化资源
    告诉对方我的序列号

流程
    <span class="token number">1</span>. Client 首先发送一个 SYN 包告诉 Server 自己的初始化序列号 X
    <span class="token number">2</span>. Sever 端收到后, 回复给 Client 一个 ACK 确认包, 告诉 Client 我收到了
    <span class="token number">3</span>. Server 向 Client 发送自己的初始序列号 Y
    <span class="token number">4</span>. Client 收到后, 回复 Server 一个 ACK 确认包
    其中, <span class="token number">2</span> <span class="token number">3</span> 可以合并为异步, 即将 ACK 确认包和 SYN 序列号包一同发送

数据发送方式
    理论上发送的数据流不存在大小限制, 但由于缓冲区大小限制, 数据有可能截断
    数据到达有序
    一旦发生丢包, TCP 会将后续包缓存起来, 等前面的包重传并接收到后再继续发送
    数据有重传也有去重

使用场景
    When <span class="token keyword">in</span> doubt, use TCP.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>TODO: TCP 心跳, 长连接, 短连接等</p></li> <li><p>UDP</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>面向数据报, 不可靠, 无连接
只需知道对方 IP, 将数据报一份一份发送过去, 其他的不用关心
最大长度存在限制, 协议头报文长度 <span class="token number">16</span> 位
    <span class="token number">2</span>^16 - <span class="token number">1</span> - <span class="token number">8</span><span class="token punctuation">(</span>UDP Head<span class="token punctuation">)</span> - <span class="token number">20</span><span class="token punctuation">(</span>IP Head<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">65507</span> 字节
    实际中为避免传输中数据包分割, 每个数据报最大字节为 <span class="token number">576</span><span class="token punctuation">(</span>MTU<span class="token punctuation">)</span> - <span class="token number">8</span> - <span class="token number">20</span> <span class="token operator">=</span> <span class="token number">548</span>

UDP 丢包可能因素
    数据报分片重组丢失
    UDP 缓冲区填满丢弃

使用场景
    实时性要求高
    多点通信

采用关键点
    网络带宽需求小, 实时性要求高
    应用无需维持连接
    低功耗
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul> <hr> <h2 id="http"><a href="#http" class="header-anchor">#</a> HTTP</h2> <img src="/image/network/readme_httprequest001.webp" alt="HTTP 请求"> <img src="/image/network/readme_httpresponse001.webp" alt="HTTP 响应"> <ul><li><p>概念</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>REQUEST:
    <span class="token operator">&lt;</span>method<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>request-url<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>headers<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>entity-body<span class="token operator">&gt;</span>

RESPONSE:
    <span class="token operator">&lt;</span>version<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>status<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>reason-phrase<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>headers<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>entity-body<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>Method</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>GET
POST
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>响应状态码</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">101</span> Switching Protocols <span class="token builtin class-name">:</span> 服务器协议转换

<span class="token number">200</span> OK <span class="token builtin class-name">:</span> 请求成功<span class="token punctuation">(</span>其后是对 GET 和 POST 请求的应答文档<span class="token punctuation">)</span>
<span class="token number">201</span> Created <span class="token builtin class-name">:</span> 请求被创建完成, 同时新的资源被创建

<span class="token number">301</span> Moved Permanently <span class="token builtin class-name">:</span> 所请求的页面已经转移至新的 url
<span class="token number">302</span> Found <span class="token builtin class-name">:</span> 所请求的页面已经临时转移至新的 url
<span class="token number">303</span> See Other <span class="token builtin class-name">:</span> 所请求的页面可在别的 url 下被找到
<span class="token number">304</span> Not Modified <span class="token builtin class-name">:</span> 资源未修改

<span class="token number">400</span> Bad Request <span class="token builtin class-name">:</span> 服务器未能理解请求
<span class="token number">401</span> Unauthorized <span class="token builtin class-name">:</span> 被请求的页面需要身份验证, 需要提供用户名和密码
<span class="token number">403</span> Forbidden <span class="token builtin class-name">:</span> 服务器理解请求, 但拒绝执行
<span class="token number">404</span> Not Found <span class="token builtin class-name">:</span> 请求失败, 请求所希望的资源未在服务器上发现

<span class="token number">500</span> Internal Server Error: 请求未完成, 服务器遇到不可预知的情况
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>HTTP 缓存</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>相关概念:
    新鲜度检测
        发起请求时, 先对缓存资源进行判断是否可以直接使用
        相关服务器响应报头字段
            Cache-Control: max-age
            Expire
    再验证
        发现缓存超时, 需要先去服务器查看该资源是否改变
        相关条件请求头部字段
            If-Modified-Since
            If-None-Match
            If-Unmodified-Since
            If-Range
            If-Match
    再验证命中
        服务器发现该 URL 资源没有发生变化, 返回 <span class="token number">304</span> Not Modified, 且不再返回该实体

流程:
    <span class="token number">1</span>. 从接收到的请求中, 解析出 URL 和各个首部
    <span class="token number">2</span>. 查询本地是否有混村副本可用
    <span class="token number">3</span>. 如果有缓存, 则进行新鲜度检测, 如果缓存足够新鲜, 则使用缓存作为响应返回<span class="token punctuation">;</span> 如果不新
        鲜了, 则构造条件请求, 发往服务器验证. 如果没有缓存, 直接将请求发往服务器.
    <span class="token number">4</span>. 从服务器返回的响应, 更新或是新增到缓存中
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li> <li><p>OAuth 认证授权协议</p></li> <li><p>HTTPS</p></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/louistin/blog.liteman/edit/master/docs/network/README.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最近更新:</span> <span class="time">2020-05-20 16:13:20 UTC+08:00</span></div></footer> <!----> </main></div><div class="global-ui"><div class="reading-progress top" data-v-21b39eda><div class="progress" data-v-21b39eda></div></div><!----></div></div>
    <script src="/assets/js/app.5aa78949.js" defer></script><script src="/assets/js/2.db8a1bd9.js" defer></script><script src="/assets/js/26.79a3a1f7.js" defer></script>
  </body>
</html>
