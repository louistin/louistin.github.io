(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{366:function(s,a,n){"use strict";n.r(a);var t=n(8),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"第一本-docker-书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第一本-docker-书"}},[s._v("#")]),s._v(" 第一本 Docker 书")]),s._v(" "),n("blockquote",[n("p",{staticStyle:{"font-family":"Arial","font-size":"80%",color:"#C0C0C0"},attrs:{align:"left"}},[s._v("全文字数 "+s._s(s.$page.readingTime.words)+" words  |  阅读时间 "+s._s(Math.ceil(s.$page.readingTime.minutes))+" mins")])]),s._v(" "),n("p"),n("div",{staticClass:"table-of-contents"},[n("ul",[n("li",[n("a",{attrs:{href:"#_01-简介"}},[s._v("01 - 简介")]),n("ul",[n("li",[n("a",{attrs:{href:"#docker"}},[s._v("Docker")])]),n("li",[n("a",{attrs:{href:"#docker-组件"}},[s._v("Docker 组件")])])])]),n("li",[n("a",{attrs:{href:"#_02-安装-docker"}},[s._v("02 - 安装 docker")])]),n("li",[n("a",{attrs:{href:"#_03-docker-入门"}},[s._v("03 - docker 入门")]),n("ul",[n("li",[n("a",{attrs:{href:"#交互式运行容器-interactive-container"}},[s._v("交互式运行容器 interactive container")])]),n("li",[n("a",{attrs:{href:"#守护式容器-deamonized-container"}},[s._v("守护式容器 deamonized container")])]),n("li",[n("a",{attrs:{href:"#容器管理"}},[s._v("容器管理")])])])]),n("li",[n("a",{attrs:{href:"#_04-使用-docker-镜像和仓库"}},[s._v("04 - 使用 docker 镜像和仓库")]),n("ul",[n("li",[n("a",{attrs:{href:"#什么是-docker-镜像"}},[s._v("什么是 docker 镜像")])]),n("li",[n("a",{attrs:{href:"#列出镜像"}},[s._v("列出镜像")])]),n("li",[n("a",{attrs:{href:"#拉取及查找镜像"}},[s._v("拉取及查找镜像")])]),n("li",[n("a",{attrs:{href:"#构建镜像"}},[s._v("构建镜像")])])])]),n("li",[n("a",{attrs:{href:"#_05-在测试中使用-docker"}},[s._v("05 - 在测试中使用 docker")]),n("ul",[n("li",[n("a",{attrs:{href:"#使用-docker-测试静态网站"}},[s._v("使用 docker 测试静态网站")])]),n("li",[n("a",{attrs:{href:"#使用-docker-构建并测试-web-应用程序"}},[s._v("使用 Docker 构建并测试 Web 应用程序")])])])])])]),n("p"),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"_01-简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_01-简介"}},[s._v("#")]),s._v(" 01 - 简介")]),s._v(" "),n("h3",{attrs:{id:"docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[s._v("#")]),s._v(" Docker")]),s._v(" "),n("ul",[n("li",[s._v("Docker 鼓励面向服务的架构和微服务架构, 单个容器只运行一个应用程序或进程")])]),s._v(" "),n("h3",{attrs:{id:"docker-组件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-组件"}},[s._v("#")]),s._v(" Docker 组件")]),s._v(" "),n("ul",[n("li",[s._v("docker 客户端和服务器\n"),n("ul",[n("li",[s._v("docker 是一个 C/S 架构程序")]),s._v(" "),n("li",[s._v("客户端向服务器或守护进程发送请求, 由其完成所有工作并返回结果")])])]),s._v(" "),n("li",[s._v("docker 镜像\n"),n("ul",[n("li",[s._v("生命周期中"),n("strong",[s._v("构建")]),s._v("阶段")]),s._v(" "),n("li",[s._v("容器的源代码")])])]),s._v(" "),n("li",[s._v("Registry\n"),n("ul",[n("li",[s._v("保存用户构建的镜像")]),s._v(" "),n("li",[s._v("分为共有和私有")])])]),s._v(" "),n("li",[s._v("docker 容器\n"),n("ul",[n("li",[s._v("生命周期中"),n("strong",[s._v("启动")]),s._v("阶段")]),s._v(" "),n("li",[s._v("容器基于镜像启动起来的")])])])]),s._v(" "),n("h2",{attrs:{id:"_02-安装-docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_02-安装-docker"}},[s._v("#")]),s._v(" 02 - 安装 docker")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kernel > 3.8")]),s._v("\nyum update\nyum remove docker  docker-common docker-selinux docker-engine\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils device-mapper-persistent-data lvm2\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加载 device mapper 模块, device-mapper 作为存储驱动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -l /sys/class/misc/device-mapper/ 或 grep device-mapper /proc/devices 查看")]),s._v("\nmodeprobe dm_mod\n\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接使用 yum install -y docker 安装的版本不是最新")]),s._v("\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y docker-ce\ndocker info\n\nsystemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\nsystemctl start/stop/restart docker\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h2",{attrs:{id:"_03-docker-入门"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_03-docker-入门"}},[s._v("#")]),s._v(" 03 - docker 入门")]),s._v(" "),n("h3",{attrs:{id:"交互式运行容器-interactive-container"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#交互式运行容器-interactive-container"}},[s._v("#")]),s._v(" 交互式运行容器 interactive container")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -i 保证容器中的 STDIN 开启")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t 为要创建的容器分配一个伪 tty 终端")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ubuntu 镜像名称, 这里为基础镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /bin/bash 容器中运行的命令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run --name ubuntu_20.04 -i -t ubuntu /bin/bash\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sudo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" password "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" louis:\nUnable to "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" image "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ubuntu:latest'")]),s._v(" locally\nlatest: Pulling from library/ubuntu\nd51af753c3d3: Pull complete\nfc878cd0a91c: Pull complete\n6154df8ff988: Pull complete\nfee5db0ff82f: Pull complete\nDigest: sha256:747d2dbbaaee995098c9792d99bd333c6783ce56150d1b11e333bbceed5c54d7\nStatus: Downloaded newer image "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" ubuntu:latest\nroot@30a9c7599262:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# uname -r")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.4")]),s._v(".223-1.el7.elrepo.x86_64\nroot@30a9c7599262:/etc/apt"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/lsb-release")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DISTRIB_ID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Ubuntu\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DISTRIB_RELEASE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.04")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DISTRIB_CODENAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("focal\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DISTRIB_DESCRIPTION")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Ubuntu 20.04 LTS"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 替换源")]),s._v("\nroot@30a9c7599262:/etc/apt"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sed -i s@/security.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list")]),s._v("\nroot@30a9c7599262:/etc/apt"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" clean "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" upgrade\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" net-tools\n\nroot@30a9c7599262:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# exit")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CONTAINER ID 和 NAMES 都可以唯一标识容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@louis ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo docker ps -a")]),s._v("\nCONTAINER ID    IMAGE   COMMAND       CREATED         STATUS        PORTS      NAMES\n5e01a9401a5d    ubuntu  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" minutes ago   Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" seconds             ubuntu_20.04\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示最后 10 个容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 附着到docer, shell 退出 container 随之 stop")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker attach ubuntu_20.04\nroot@5e01a9401a5d:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器管理")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker start/stop/restart ubuntu_20.04\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" ubuntu_20.04\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br")])]),n("h3",{attrs:{id:"守护式容器-deamonized-container"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#守护式容器-deamonized-container"}},[s._v("#")]),s._v(" 守护式容器 deamonized container")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# sudo docker run --name daemon_dave -d ubuntu /bin/sh -c "while true; do echo hello world; sleep 1; done"')]),s._v("\n740f6405a0a87c2d7fdf20c902304ff3da3748f09f360f52a00e9a9d84db1565\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看日志")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker logs -f daemon_dave\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker logs --tail "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" daemon_dave  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最新10条")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker logs --tail "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -ft daemon_dave "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最新带时间戳")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看进程")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" daemon_dave\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在容器内部运行进程")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -t -i daemon_dave "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /root/new_file\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在容器中启动 shell")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -t -i daemon_dave /bin/bash\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器管理")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" daemon_dave    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 快速停止, 其他同上")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 无论容器退出码是什么, 都会自动重启容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always --name daemon_dave -d ubuntu /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo hello world"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只有当退出码非 0 时才重启, 最多重启 5 次")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run --restart"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure:5 --name daemon_dave -d ubuntu /bin/sh -c "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo hello world"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("h3",{attrs:{id:"容器管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#容器管理"}},[s._v("#")]),s._v(" 容器管理")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器详细信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker inspect daemon_dave\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选定查看结果")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker inspect daemon_dave --format "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{ .NetworkSettings.IPAddress }}'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除所有容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a -q"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h2",{attrs:{id:"_04-使用-docker-镜像和仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_04-使用-docker-镜像和仓库"}},[s._v("#")]),s._v(" 04 - 使用 docker 镜像和仓库")]),s._v(" "),n("h3",{attrs:{id:"什么是-docker-镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-docker-镜像"}},[s._v("#")]),s._v(" 什么是 docker 镜像")]),s._v(" "),n("ul",[n("li",[s._v("docker 镜像是由文件系统叠加而成")]),s._v(" "),n("li",[s._v("docker 中, root 文件系统永远只能是只读状态")]),s._v(" "),n("li",[s._v("docker 利用联合加载 union mount 技术在 root 文件系统层上加载更多的只读文件系统\n"),n("ul",[n("li",[s._v("联合加载一次同时加载多个文件系统, 但是外面只能看到一个文件系统")]),s._v(" "),n("li",[s._v("联合加载将各层文件系统叠加在一起, 最终的文件系统会包含所有底层的文件和目录")])])]),s._v(" "),n("li",[s._v("写时复制 copy on write\n"),n("ul",[n("li",[s._v("创建新容器时, docker 会构建出一个镜像栈, 并在栈的最顶层添加一个读写层")]),s._v(" "),n("li",[s._v("这个读写层及其下面的镜像层以及一些配置数据, 就构成一个容器")])])])]),s._v(" "),n("p",[n("strong",[s._v("Docker 文件系统层")]),n("br"),s._v(" "),n("img",{attrs:{src:s.$withBase("/image/note/thedockerbook/04_001_docker文件系统层.webp"),alt:"Docker 文件系统层"}})]),s._v(" "),n("h3",{attrs:{id:"列出镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#列出镜像"}},[s._v("#")]),s._v(" 列出镜像")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nubuntu              latest              1d622ef86b13        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" weeks ago         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("73")]),s._v(".9MB\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定 tag 启动容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run -t -i --name new_container ubuntu:latest /bin/bash\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地镜像保存路径 /var/lib/docker")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器路径 /var/lib/docker/containers")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"拉取及查找镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#拉取及查找镜像"}},[s._v("#")]),s._v(" 拉取及查找镜像")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认拉取 latest 版本, 可添加 tag 拉取指定版本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker pull IMAGE_NAME:TAG\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# OFFICIAL 官方构建")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker search IMAGE_NAME:TAG\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"构建镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像"}},[s._v("#")]),s._v(" 构建镜像")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("使用 "),n("code",[s._v("commit")]),s._v(" 构建")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run -it ubuntu:latest /bin/bash\nroot@bdcfd6b79a7f:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# apt -y update && apt install -y apache2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 CONTAINER ID")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -l -q\nbdcfd6b79a7f\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker commit -m"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"A new custom image"')]),s._v(" --author"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"louis"')]),s._v(" bdcfd6b79a7f louis/apache2:webserver\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker images\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run -it louis/apache2:webserver /bin/bash\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("使用 Dcokerfile 构建")]),s._v(" "),n("ul",[n("li",[s._v("Dockerfile 执行流程\n"),n("ul",[n("li",[s._v("Docker 从基础镜像运行一个容器")]),s._v(" "),n("li",[s._v("执行一条指令, 对容器做出修改")]),s._v(" "),n("li",[s._v("执行类似 "),n("code",[s._v("docker commit")]),s._v(" 的操作, 提交一个新的镜像层")]),s._v(" "),n("li",[s._v("docker 基于刚提交的镜像运行一个新容器")]),s._v(" "),n("li",[s._v("执行 Dockerfile 的下一条指令, 直到所有指令执行完毕")])])]),s._v(" "),n("li",[s._v("docker 构建镜像过程中会将之前的镜像层视为缓存, 再次构建时会从最新修改的指令处开始执行")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建目录 static_web, 并在其中创建文件 Dockerfile")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Dockerfile 如下")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --no-cache 略过缓存功能")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker build -t"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"louis/static_web:v0.0.1"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看构建过程")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker histoty IMAGE_ID\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -d 以分离 detached 的方式在后台启动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p docker 运行时公开端口给外部宿主机, 默认自动分配, 可以绑定IP:PORT")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -P 后无需指定端口, 自动公开所有 EXPOSE 端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# nginx -g "daemon off;" 以前台方式启动 nginx')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1::80 --name static_web louis/static_web:v0.0.1 nginx -g "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看宿主机映射端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis static_web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID        IMAGE                     COMMAND                  CREATED             STATUS              PORTS                     NAMES\n708aca0da6b4        louis/static_web:v0.0.1   "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx -g \'daemon of…"')]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" seconds ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" seconds       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:32769-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   static_web\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis static_web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker port CONTAINER_ID "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:32769\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Version: 0.0.1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("20.04\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" Louis Tian "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"louis.tianlu@gmail.com"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i s@/security.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改时间戳, 前面的缓存命中, 后面的指令将会重新执行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" REFRESHED_AT 2020"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("05"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("13\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN 指令会在shell 中使用 /bin/sh -c 执行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他方式 exec 格式: RUN [")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apt"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('" install"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-y"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt update\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y nginx\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" echo "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hi, I am in your container'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v(" /var/www/html/index.nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("debian.html\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ONBUILD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" . /app/src\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("Dockerfile 指令")]),s._v(" "),n("ul",[n("li",[n("p",[n("code",[s._v("CMD")])]),s._v(" "),n("ul",[n("li",[s._v("指定容器启动时要运行的命令")]),s._v(" "),n("li",[n("code",[s._v("docker run")]),s._v(" 命令会覆盖 "),n("code",[s._v("CMD")]),s._v(" 命令")]),s._v(" "),n("li",[s._v("Dockerfile 中只能指定一条 CMD, 多条只有最后一条有效, 可以结合 Supervisor 管理多进程")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("ENTRYPOINT")])]),s._v(" "),n("ul",[n("li",[s._v("不会被 "),n("code",[s._v("docker run")]),s._v(" 命令覆盖")]),s._v(" "),n("li",[n("code",[s._v("docker run --entrypoint")]),s._v(" 可覆盖 "),n("code",[s._v("ENTRYPOINT")])])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("WORKDIR")])]),s._v(" "),n("ul",[n("li",[s._v("从镜像创建一个新容器时, 在容器内部设置一个工作目录(同时切到该目录), "),n("code",[s._v("ENCRYPOINT")]),s._v(",\n"),n("code",[s._v("/")]),s._v(", "),n("code",[s._v("CMD")]),s._v(" 指定的程序在该目录下执行")]),s._v(" "),n("li",[s._v("可以多次执行, 每次执行就会切换到对应目录, 后续命令都在该目录执行")]),s._v(" "),n("li",[n("code",[s._v("docker run -w")]),s._v(" 可覆盖 "),n("code",[s._v("WORKDIR")])])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("ENV")])]),s._v(" "),n("ul",[n("li",[s._v("在镜像构建过程中设置环境变量, 持久保存")]),s._v(" "),n("li",[s._v("新的环境变量可以在后续任何 RUN 指令中使用")]),s._v(" "),n("li",[n("code",[s._v("docker run -e")]),s._v(" 旨在运行时有效")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("USER")])]),s._v(" "),n("ul",[n("li",[s._v("指定镜像会以什么样的用户去运行")]),s._v(" "),n("li",[n("code",[s._v("docker run -u")]),s._v(" 覆盖该值")]),s._v(" "),n("li",[s._v("不指定默认为 root")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("VOLUME")])]),s._v(" "),n("ul",[n("li",[s._v("向基于镜像创建的容器添加卷, 一个卷可以存在以一个或多个容器内的特定目录")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("ADD")])]),s._v(" "),n("ul",[n("li",[s._v("将构建环境下的文件和目录复制到镜像中, 已存在不会覆盖, 目的路径不全会自动创建")]),s._v(" "),n("li",[s._v("文件源也可以使用 URL")]),s._v(" "),n("li",[s._v("gzip bzip2 xz 文件添加时会自动 unpack")]),s._v(" "),n("li",[s._v("后续指令构建缓存失效")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("COPY")])]),s._v(" "),n("ul",[n("li",[s._v("只关心文件复制, 不做提取和解压")]),s._v(" "),n("li",[s._v("本地文件必须在 Dockerfile 同一目录")])])]),s._v(" "),n("li",[n("p",[n("code",[s._v("ONBUILD")])]),s._v(" "),n("ul",[n("li",[s._v("为镜像添加触发器 trigger, 当一个镜像被用作其他镜像的基础镜像时, 该镜像的触发器会被执行")]),s._v(" "),n("li",[s._v("构建时, 会在 "),n("code",[s._v("FROM")]),s._v(" 后立即执行")]),s._v(" "),n("li",[s._v("只会被子镜像继承一次, 不能继续被孙镜像继承")]),s._v(" "),n("li",[s._v("不能使用指令 "),n("code",[s._v("FROM")]),s._v(" "),n("code",[s._v("MAINTAINER")]),s._v(" "),n("code",[s._v("ONBUILD")])]),s._v(" "),n("li",[n("code",[s._v("sudo docker inspect CONTAINER_ID")]),s._v(" 查看")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sudo docker run -i -t louis/static_web 不需要再指定 /bin/bash, 并传入 -l 参数")]),s._v("\nCMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-l"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nENCRYPONIT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 组合 CMD ENCRYPOINT, 可在 docker run 时灵活传入参数")]),s._v("\nENCRYPONIT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/sbin/nginx"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nCMD "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-h"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nWORKDIR /opt/nginx/conf\nRUN "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" conf.d\nWORKDIR /opt/nginx/conf/conf.d\nENTRYPOINT "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"touch louis.com.conf"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nENV RVM_PATH /home/rvm\nRUN gem "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" unicorn\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# docker run -e "TARGET_PATH=/opt/app" 只在运行时有效')]),s._v("\nENV TARGET_PATH /opt/app\nWORKDIR "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TARGET_PATH")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WORKDIR 值设置为 /opt/app")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为基于此镜像创建的容器创建一个或多个挂载点")]),s._v("\nVOLUME "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"opt/project"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nADD software.lic /opt/application/software.lic\n\nCOPY conf.d /etc/apache2/\n\nONBUILD ADD "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /app/src\nONBUILD RUN "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /app/src "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])])])])]),s._v(" "),n("li",[n("p",[s._v("镜像推送到 Docker hub")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker login\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker tag IMAGE_ID DOCKERHUB_USRNAME/IMAGE_NAME:TAG\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker push DOCKERHUB_USRNAME/IMAGE_NAME:TAG\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("删除镜像")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker rmi IMAGE_NAME\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"_05-在测试中使用-docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_05-在测试中使用-docker"}},[s._v("#")]),s._v(" 05 - 在测试中使用 docker")]),s._v(" "),n("h3",{attrs:{id:"使用-docker-测试静态网站"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-测试静态网站"}},[s._v("#")]),s._v(" 使用 docker 测试静态网站")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis sample"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ tree\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- Dockerfile\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- nginx\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- global.conf\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("-- nginx.conf\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("-- website\n    `-- index.html\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建与运行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker build -t louistian/nginx "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis sample"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nlouistian/nginx     latest              3fdba3a08ccb        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" minutes ago      510MB\ncentos              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("                   b5b4d78bc90c        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" days ago          203MB\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -v 将宿主机 website/ 作为卷, 挂载到容器中")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 卷的修改会直接生效, 提交或创建镜像时, 卷不被包含在镜像中. 容器停止, 卷内容依然存在")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --name website -v "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v("/website:/var/www/html/website louistian/nginx nginx\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis sample"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -l\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                   NAMES\n2e41582b07fa        louistian/nginx     "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),s._v("             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" minutes ago      Up "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" minutes       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:32780-"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp   website\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Dockerfile VERSION: 0.0.1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("7\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" Louis "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"louis.tianlu@gmail.com"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" REFRESHED_AT 2020"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("05"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("14\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum update "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum install epel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("release "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" yum install nginx "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /var/www/html\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不同风格的复制")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" nginx/global.conf /etc/nginx/conf.d/\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ADD")]),s._v(" nginx/nginx.conf /etc/nginx/nginx.conf\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 80\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# global.conf")]),s._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  listen          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  server_name     _"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  root            /var/www/html/website"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  index           index.html index.htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  access_log      /var/log/nginx/default_accesss.log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  error_log       /var/log/nginx/default_error.log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx.conf")]),s._v("\nuser root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nworker_processes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\npid /run/nginx.pid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ndaemon off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nginx 强制前台运行, 进程不中断, 保持容器活跃状态")]),s._v("\n\nevents "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    sendfile on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    tcp_nopush on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    tcp_nodelay on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    keepalive_timeout "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    types_hash_max_size "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    include /etc/nginx/mime.types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    default_type application/octet-stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    access_log /var/log/nginx/access.log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    error_log /var/log/nginx/error.log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gzip")]),s._v(" on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    gzip_disable "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msie6"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    include /etc/nginx/conf.d/*.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- index.html --\x3e")]),s._v("\nHello World."),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("br")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\nlouis.tianlu@gmail.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"使用-docker-构建并测试-web-应用程序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-构建并测试-web-应用程序"}},[s._v("#")]),s._v(" 使用 Docker 构建并测试 Web 应用程序")]),s._v(" "),n("h4",{attrs:{id:"构建-sinatra-镜像与容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建-sinatra-镜像与容器"}},[s._v("#")]),s._v(" 构建 sinatra 镜像与容器")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加 webapp 目录, 并确保 webapp/bin/webapp 权限可执行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis sinatra"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ tree\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- Dockerfile\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("-- webapp\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- bin\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("-- webapp\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- Dockerfile\n    "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("-- lib\n        "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("-- app.rb\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker build -t louistian/sinatra "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4567")]),s._v(" --name webapp -v "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v("/webapp:/opt/webapp louistian/sinatra\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker logs 类似 tail")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker logs webapp\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker logs -f webapp\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" webapp\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker port webapp "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4567")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis sinatra"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -i -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accept: application/json'")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=louis&status=online'")]),s._v(" http://localhost:32781/json\nHTTP/1.1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nContent-Type: text/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf-8\nContent-Length: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("34")]),s._v("\nX-Xss-Protection: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mode")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("block\nX-Content-Type-Options: nosniff\nX-Frame-Options: SAMEORIGIN\nServer: WEBrick/1.6.0 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ruby/2.7.0/2019-12-25"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDate: Thu, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" May "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" 08:22:01 GMT\nConnection: Keep-Alive\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"louis"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"online"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Version: 0.0.1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("20.04\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" Louis "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"louis.tianlu@gmail.com"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" REFRESHED_AT 2020"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("05"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("14\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i s@/security.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt update "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y ruby ruby"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev build"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("essential redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tools\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" gem install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("document sinatra json redis\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p /opt/webapp\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 4567\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/webapp/bin/webapp"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h4",{attrs:{id:"构建-redis-镜像与容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建-redis-镜像与容器"}},[s._v("#")]),s._v(" 构建 redis 镜像与容器")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ tree\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n`-- Dockerfile\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker build -t louistian/redis "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加 --protected-mode no 否则测试时连接后不能操作")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v(" --name redis louistian/redis --protected-mode no\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以在宿主机连接测试")]),s._v("\nredis-cli -h "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p PORT\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("div",{staticClass:"language-dockerfile line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Version: 0.0.1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" ubuntu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("18.04\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LABEL")]),s._v(" maintainer="),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"louis.tianlu@gmail.com"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" REFRESHED_AT 2020"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("05"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("14\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i s@/security.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" sed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt update "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" apt install "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("y redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tools\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 6379\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/bin/redis-server"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("docker 自己的网络栈")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("docker 容器公开端口并绑定到本地网络接口, 这样可以把容器里的服务在本地宿主机所在的外部网络\n上公开")])]),s._v(" "),n("li",[n("p",[s._v("内部网络")]),s._v(" "),n("ul",[n("li",[s._v("docker0\n"),n("ul",[n("li",[s._v("虚拟的以太网桥, 用于连接容器和本地宿主网络")])])]),s._v(" "),n("li",[s._v("veth*\n"),n("ul",[n("li",[s._v("容器创建时会创建一组互联的网络接口. 接口其中一端作为容器里的 eth0 接口, 另一端统一命\n名为 veth*, 作为宿主机的一个端口")]),s._v(" "),n("li",[s._v("每个 veth* 接口都绑定到 docker0 网桥, 由此创建一个由宿主机和所有容器共享的虚拟子网")])])])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 宿主机")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker0 虚拟网桥")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v("\ndocker0: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.1  netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".0.0  broadcast "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".255.255\n        inet6 fe80::42:faff:fe65:fc0  prefixlen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("  scopeid 0x2"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("link"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        ether 02:42:fa:65:0f:c0  txqueuelen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("76935")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4351084")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.1")]),s._v(" MiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172917")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111531538")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(" GiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\neth0: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.2  netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".240.0  broadcast "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".15.255\n        inet6 fe80::5054:ff:fe1d:9861  prefixlen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("  scopeid 0x2"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("link"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        ether "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(":54:00:1d:98:61  txqueuelen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2232356")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1938976249")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),s._v(" GiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1259922")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("288469632")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("275.1")]),s._v(" MiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nlo: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,LOOPBACK,RUNNING"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n        inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1  netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.0")]),s._v(".0.0\n        inet6 ::1  prefixlen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),s._v("  scopeid 0x1"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("host"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        loop  txqueuelen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Local Loopback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("213")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("34695")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("33.8")]),s._v(" KiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("213")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("34695")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("33.8")]),s._v(" KiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nveth36ad046: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        inet6 fe80::c434:a4ff:fe9a:e233  prefixlen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("  scopeid 0x2"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("link"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        ether c6:34:a4:9a:e2:33  txqueuelen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("578")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("578.0")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nvethb6c2a94: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        inet6 fe80::68b3:89ff:fe9a:6296  prefixlen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("  scopeid 0x2"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("link"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        ether 6a:b3:89:9a:62:96  txqueuelen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("828")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("828.0")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker 为容器分配了 IP 172.18.0.3")]),s._v("\nroot@cb9492edd6b6:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ifconfig")]),s._v("\neth0: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.3  netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".0.0  broadcast "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".255.255\n        ether 02:42:ac:12:00:03  txqueuelen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6639")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("31259333")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("31.2")]),s._v(" MB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("760")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50193")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50.1")]),s._v(" KB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nlo: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,LOOPBACK,RUNNING"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n        inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1  netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.0")]),s._v(".0.0\n        loop  txqueuelen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Local Loopback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        RX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        TX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        TX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器访问外网, 第一跳就是宿主机网络上的 docker0 接口的网关 IP")]),s._v("\nroot@cb9492edd6b6:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# traceroute www.baidu.com")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("traceroute")]),s._v(" to www.baidu.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("180.101")]),s._v(".49.11"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" hops max, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" byte packets\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.028")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.011")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.009")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  * "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.105")]),s._v(".105.130 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.105")]),s._v(".105.130"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.081")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.970")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  * "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.104")]),s._v(".251.210 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.104")]),s._v(".251.210"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.643")]),s._v(" ms *\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br")])])])])]),s._v(" "),n("li",[n("p",[s._v("连接 redis")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("通过映射到宿主机的 PORT")])]),s._v(" "),n("li",[n("p",[s._v("直接使用虚拟子网 IP PORT")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker inspect redis\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NetworkSettings"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Bridge"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SandboxID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"868e968ad8ca579357c716c6f6786651c8a1c00efda93f15f7c151a416902d0b"')]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HairpinMode"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LinkLocalIPv6Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LinkLocalIPv6PrefixLen"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Ports"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6379/tcp"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HostIp"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0"')]),s._v(",\n                      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"HostPort"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"32786"')]),s._v("\n                  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SandboxKey"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/run/docker/netns/868e968ad8ca"')]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SecondaryIPAddresses"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SecondaryIPv6Addresses"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3ccba82cda80d3f56e545182d779e4b91c3e905ef03d57c5c17a4f83b582d0fa"')]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.1"')]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GlobalIPv6Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GlobalIPv6PrefixLen"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.2"')]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPPrefixLen"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:ac:12:00:02"')]),s._v(",\n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Networks"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAMConfig"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Links"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Aliases"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NetworkID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7e1e523b599001e0d6b924e457ece4e960ab73aee50bac5f27e5763066570839"')]),s._v(",\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3ccba82cda80d3f56e545182d779e4b91c3e905ef03d57c5c17a4f83b582d0fa"')]),s._v(",\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.1"')]),s._v(",\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.18.0.2"')]),s._v(",\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPPrefixLen"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(",\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GlobalIPv6Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GlobalIPv6PrefixLen"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:ac:12:00:02"')]),s._v(",\n                  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DriverOpts"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null\n              "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用映射 PORT")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ redis-cli -h "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32786")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:3278"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接使用子网 IP PORT")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ redis-cli -h "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.2 -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.2:637"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br")])])])])]),s._v(" "),n("li",[n("p",[s._v("容器互连")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确保 redis 容器启动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run -d --name redis louistian/redis\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --link 建立两个容器间的父子关系")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#         redis 要连接的容器名称")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#         db 连接后容器别名")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis sinatra"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker run -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4567")]),s._v(" --name webapp --link redis:db -t -i -v "),n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v("/webapp:/opt/webapp louistian/sinatra /bin/bash\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看连接信息")]),s._v("\nroot@d99a012cf351:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/hosts")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\tlocalhost\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.2\tdb 34177ffe0f93 redis\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.3\td99a012cf351\n\nroot@d99a012cf351:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# env")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REFRESHED_AT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-05-14\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOSTNAME")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("d99a012cf351\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PWD")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_PORT_6379_TCP_ADDR")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.2\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_PORT_6379_TCP")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp://172.18.0.2:6379\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DB_PORT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp://172.18.0.2:6379\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[n("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("HOME")])]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("容器通信")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# louistian/sinatra 中启动")]),s._v("\nroot@d99a012cf351:~"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /opt/webapp/bin/webapp &")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 宿主机请求")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis lib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -i -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accept: application/json'")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name=louis&status=online'")]),s._v(" http://localhost:32790/json\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 redis 容器数据")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("louis@louis lib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -i http://localhost:32790/json\nHTTP/1.1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nContent-Type: text/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf-8\nContent-Length: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v("\nX-Xss-Protection: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mode")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("block\nX-Content-Type-Options: nosniff\nX-Frame-Options: SAMEORIGIN\nServer: WEBrick/1.6.0 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ruby/2.7.0/2019-12-25"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDate: Fri, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" May "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" 02:36:13 GMT\nConnection: Keep-Alive\n\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[{'),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("name"),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(":"),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("louis"),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(","),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("status"),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(":"),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("online"),n("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('}]"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /home/louis/studio/sinatra/webapp/lib")]),s._v("\nrequire "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rubygems"')]),s._v("\nrequire "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sinatra"')]),s._v("\nrequire "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"json"')]),s._v("\nrequire "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis"')]),s._v("\n\nclass App "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" Sinatra::Application\n      redis "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Redis.new"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(":host "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db'")]),s._v(", :port "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'6379'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" :bind, "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0'")]),s._v("\n\n      get "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<h1>DockerBook Test Redis-enabled Sinatra app</h1>"')]),s._v("\n      end\n\n      get "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/json'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n        params "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" redis.get "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"params"')]),s._v("\n        params.to_json\n      end\n\n      post "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/json/?'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n        redis.set "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"params"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".to_json\n        params.to_json\n      end\nend\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])])])]),s._v(" "),n("blockquote",[n("p",[s._v("! docker 学习暂时告一段落, 接下来内容主要以应用为主")])])])}),[],!1,null,null,null);a.default=e.exports}}]);