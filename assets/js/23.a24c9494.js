(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{353:function(s,t,e){"use strict";e.r(t);var n=e(8),a=Object(n.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"网站自动化布署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#网站自动化布署"}},[s._v("#")]),s._v(" 网站自动化布署")]),s._v(" "),e("blockquote",[e("p",[s._v("OS: CentOS 7.5"),e("br"),s._v("\nProject: vuepress")])]),s._v(" "),e("h2",{attrs:{id:"_1-环境搭建"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境搭建"}},[s._v("#")]),s._v(" 1. 环境搭建")]),s._v(" "),e("ul",[e("li",[s._v("确认安装JDK, NodeJS, npm, vuepress")])]),s._v(" "),e("h2",{attrs:{id:"_2-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置"}},[s._v("#")]),s._v(" 2. 配置")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("首先获取GitHub Personal access token")]),s._v(" "),e("ul",[e("li",[s._v("GitHub -> setting -> Developer settings -> Personal access tokens -> Generate new token")]),s._v(" "),e("li",[s._v("勾选 repo, admin:repo_hook")]),s._v(" "),e("li",[s._v("生成 access token, 复制保存, 后面再也看不到了\t1dfa359cd72998b49aa8c830e5594559f86dfbb3")])])]),s._v(" "),e("li",[e("p",[s._v("配置Jenkins")]),s._v(" "),e("ul",[e("li",[s._v("系统设置 -> Github -> Github Server -> API URL: https://api.github.com -> 凭据 -> 添加 -> Jenkins")]),s._v(" "),e("li",[s._v("类型 -> secret text -> 上一步的 Personal access token -> add -> 连接测试 -> 保存")])])]),s._v(" "),e("li",[e("p",[s._v("Github 项目主页配置")]),s._v(" "),e("ul",[e("li",[s._v("复制 "),e("code",[s._v("https://github.com/louistin/blog.liteman.git")])])])]),s._v(" "),e("li",[e("p",[s._v("Jenkins 新建构建项目")]),s._v(" "),e("ul",[e("li",[s._v("输入名称 -> 构建自由风格软件项目")]),s._v(" "),e("li",[s._v("源码管理 -> Git -> 仓库 URL "),e("code",[s._v("https://github.com/louistin/blog.liteman.git")])]),s._v(" "),e("li",[s._v("Credentials -> Username with password -< Github 账号+密码")]),s._v(" "),e("li",[s._v("源码库浏览器 -> githubweb -> URL "),e("code",[s._v("https://github.com/louistin/blog.liteman")])]),s._v(" "),e("li",[s._v("构建触发器 -> GitHub hook trigger for GiTScm polling")]),s._v(" "),e("li",[s._v("构建环境 -> Use secret text(s) or file(s) -> 指定凭据 -> Personal access token(前面配置的)")]),s._v(" "),e("li",[s._v("Run the build in an NVM managed environment")]),s._v(" "),e("li",[s._v("Version: 12.14.0")])])]),s._v(" "),e("li",[e("p",[s._v("构建脚本 -> Shell")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\nnode -v "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" -v "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#vuepress -v &&")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" ci "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run docs:build "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" docs "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" .vuepress "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" dist "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /opt/openresty/nginx/html/liteman/blog -rf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("配置Github webhook 地址")]),s._v(" "),e("ul",[e("li",[s._v("本工程 settings -> Webhooks -> add webhook -> "),e("code",[s._v("http://111.229.202.186:10000/jenkins/github-webhook")])])])]),s._v(" "),e("li",[e("p",[s._v("Jenkins 页面立即构建可以测试, 点击正在构建 -> Console logout 可以看日志")])])]),s._v(" "),e("h2",{attrs:{id:"faq"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#faq"}},[s._v("#")]),s._v(" FAQ")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("运行时没有权限?\n"),e("code",[s._v("https://www.cnblogs.com/paisen/p/9776690.html")]),s._v("\n直接将目标目录执行 "),e("code",[s._v("CHMOD 777 -R DIR")])])]),s._v(" "),e("li",[e("p",[s._v("命令找不到怎么办?\n先whereis 找到命令目录, 然后 "),e("code",[s._v("ln -s /usr/local/bin/node /usr/bin/")]),s._v(" 这样建立一个软链接\nnpm 也需要执行同样的操作, 这样可以不使用 nodejs 插件而直接使用系统安装版本")])]),s._v(" "),e("li",[e("p",[s._v("插件下载太慢怎么办?\n替换源, 同时替换搜索引擎为baidu")])])]),s._v(" "),e("h2",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("https://juejin.im/post/5ad1980e6fb9a028c42ea1be#heading-4\nhttps://www.cnblogs.com/loveyouyou616/p/8714544.html\nhttps://www.cnblogs.com/ninefish/p/9818080.html\nhttps://www.cnblogs.com/yoyoketang/p/12115569.html\nhttps://www.jianshu.com/p/f90013658c38\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])])}),[],!1,null,null,null);t.default=a.exports}}]);