(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{358:function(s,a,t){"use strict";t.r(a);var e=t(8),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"tcp-协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp-协议"}},[s._v("#")]),s._v(" TCP 协议")]),s._v(" "),t("blockquote",[t("p",[s._v("利用 wireshark 软件分析三次握手与四次挥手")])]),s._v(" "),t("ul",[t("li",[s._v("wireshark 抓包与协议分层\n"),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_basic_wireshark_001.webp"),alt:"TCP 与分层协议"}})])]),s._v(" "),t("h2",{attrs:{id:"tcp-协议基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp-协议基础"}},[s._v("#")]),s._v(" TCP 协议基础")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("TCP 协议报文首部")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("          Source Port          "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       Destination Port        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                        Sequence Number                        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                    Acknowledgment Number                      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  Data "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("U"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("A"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("P"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("R"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("F"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Offset"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Reserved  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("R"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("C"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("Y"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("I"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("            Window             "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("G"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("K"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("H"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("T"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("N"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("N"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           Checksum            "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         Urgent Pointer        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                    Options                    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    Padding    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                             data                              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\nSequence Number "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 包序号, 解决网络包乱序问题\nAcknowledgment Number "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ACK 确认收到, 解决丢包问题\nWindow "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 滑动窗口, 解决流量控制\nTCP Flags "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" 包的类型, 用于操控 TCP 的状态机\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),s._v(" "),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_header_001.webp"),alt:"TCP Header"}}),s._v(" "),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_basic_wireshark_002.webp"),alt:"TCP 与分层协议"}})]),s._v(" "),t("li",[t("p",[s._v("TCP 状态机")]),s._v(" "),t("p",[s._v("TCP 所谓的连接, 其实是通讯双方维护的一个 "),t("strong",[s._v("连接状态")]),s._v(", 使其看起来好像连接一样.")]),s._v(" "),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_statemachine_001.webp"),alt:"TCP 状态机"}})]),s._v(" "),t("li",[t("p",[s._v("三次握手")]),s._v(" "),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_connect_wireshark_001.webp"),alt:"TCP 三次握手"}}),s._v(" "),t("p",[t("strong",[s._v("第一次握手")]),t("br"),s._v(" "),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_connect_wireshark_002.webp"),alt:"TCP 第一次握手"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Client 将标志位 SYN 置为 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", 随机产生一个值 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" J\n将数据包发送给 Server, Client 进入 SYN_SENT 状态, 等待 Server 确认\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("第二次握手")]),t("br"),s._v(" "),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_connect_wireshark_003.webp"),alt:"TCP 第二次握手"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Server 收到数据包后由标志位 SYN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 知道 Client 请求建立连接, Server 将标志位 SYN\n  和 ACK 都置为 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", ack "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" J + "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", 随机产生一个值 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" K\n将数据包发送给 Client, Server 进入 SYN_RCVD 状态\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("strong",[s._v("第三次握手")]),t("br"),s._v(" "),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_connect_wireshark_004.webp"),alt:"TCP 第三次握手"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Client 收到数据包, 检查 ack 是否为 J + "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", 正确则将标志位 ACK 值置为 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", ack "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" K + "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n将数据包发送给 Server\nServer 收到数据包, 检查 ack 是否为 K + "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", 标志位 ACK 是否为 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", 正确则连接成功.\nClient 和 Server 进入 ESTABLISHED 状态, 完成三次握手, 双方可以发送数据\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("注意事项")])]),s._v(" "),t("blockquote",[t("ol",[t("li",[s._v("建立连接时 SYN 超时")])]),s._v(" "),t("blockquote",[t("p",[s._v("Server 回复 Client SYN-ACK 后没有收到 Client 回复的 ACK, 那么连接处于一个既没成\n功, 也没失败的中间状态. 此时 Server 会每隔 1 2 4 8 16s 重发一次 SYN-ACK 数据包,\n总计 1 + 2 + 4 + 8 + 16 + 32 = 63s 后, TCP 会断开连接")])])]),s._v(" "),t("blockquote",[t("ol",{attrs:{start:"2"}},[t("li",[s._v("ISN (Inital Sequence Number)")])]),s._v(" "),t("blockquote",[t("p",[s._v("ISN 为什么不能从 1 开始? 考虑到假设 Client 发出 10 个 segment 后, 网络断开, 此时\nClient 重连, 又实用 1 为 ISN, 但之前的包到了, 此时会被当做新连接的包处理, Client\n和 Server 端的 SYN 就对不上了. ISN 的周期是与一个每 4 微妙 +1 的逻辑时钟绑定, 直到\n大于 2^32, 再从 0 开始, 所以 TCP segment 在网络上最大存活时间不会超过这一个周期\n即 MSL <= 4.55h")])])]),s._v(" "),t("blockquote",[t("ol",{attrs:{start:"3"}},[t("li",[s._v("MSL 与 TIME_WAIT")])]),s._v(" "),t("blockquote",[t("p",[s._v("RFC 规定 MSL = 120s, Linux 设置为 30s.\n从 TIME_WAIT -> CLOSED 状态, 超时时间设置为 2MSL. 主要是为了"),t("br"),s._v("\n1). TIME_WAIT 确保有足够的时间让对方受到 ACK, 被动关闭方没有收到 ACK, 会触发重发\nFIN, 来回时间满足 2MSL"),t("br"),s._v("\n2). 有足够时间让此连接不与后面的连接混在一起")])])]),s._v(" "),t("blockquote",[t("ol",{attrs:{start:"4"}},[t("li",[s._v("TIME_WAIT 数量太多")])]),s._v(" "),t("blockquote",[t("p",[s._v("大并发短连接时出现, 会消耗系统资源\n解决方法待补充")])])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("参考资料")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/huskiesir/p/10212053.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("SYN 攻击与防范"),t("OutboundLink")],1)])])])]),s._v(" "),t("li",[t("p",[s._v("四次挥手")]),s._v(" "),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_close_wireshark_001.webp"),alt:"TCP 四次挥手"}}),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("TCP 连接为全双工, 可以由任一方发起关闭. 同时每一个方向都必须单独关闭.\n收到一个 FIN 只表示这一方向上没有数据流动"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("不再收到数据"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", 但此方向上仍然可以发送数据, 直到\n  这一方向上也发送了 FIN.\n首先发送的一方主动关闭, 另一方被动关闭.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("第一次挥手")]),t("br"),s._v(" "),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_close_wireshark_002.webp"),alt:"TCP 第一次挥手"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Client 发送 FIN, 关闭 Client 到 Server 的数据传输, Client 进入 FIN_WAIT_1 状态\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("strong",[s._v("第二三次挥手")]),t("br"),s._v(" "),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_close_wireshark_003.webp"),alt:"TCP 第二三次挥手"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("这里的第二次, 第三次挥手在一个数据包中 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("如果此时 Server 还有数据要发送, 就不能合并"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nServer 收到 FIN 后, 发送一个 ACK 到 Client, 确认序列号 ack 为收到序列号 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" + "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(",\n  Server 进入 CLOSE_WAIT 状态\nServer 发送 FIN, 关闭 Server 到 Client 的数据传输, Server 进入 LAST_ACK 状态\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("第四次挥手")]),t("br"),s._v(" "),t("img",{attrs:{src:s.$withBase("/image/network/tcp-ip/001_tcp_close_wireshark_004.webp"),alt:"TCP 第四次挥手"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Client 收到 FIN 后, 进入 TIME_WAIT 状态, 再发送一个 ACK 给 Server, 确认序列号 ack\n  为收到序列号 syn + "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", Server 收到后进入 CLOSED 状态, 完成四次挥手\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("参考资料")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/knowledgebao/article/details/84626238?depth_1-utm_source=distribute.pc_relevant.none-task&utm_source=distribute.pc_relevant.none-task",target:"_blank",rel:"noopener noreferrer"}},[s._v("TIME_WAIT 状态的产生原因及解决方法"),t("OutboundLink")],1)])])])]),s._v(" "),t("li",[t("p",[s._v("TCP 传输")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("TCP 重传机制")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("TCP 重传机制中 Timeout 设置\n    时间过长, 重发变慢, 效率低, 性能差\n    时间过短, 可能导致重发未丢失的包, 增加网络拥塞, 导致更多超时\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])])])])]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"faq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#faq"}},[s._v("#")]),s._v(" FAQ")]),s._v(" "),t("ol",[t("li",[s._v("SYN Flood 攻击")])])])}),[],!1,null,null,null);a.default=r.exports}}]);