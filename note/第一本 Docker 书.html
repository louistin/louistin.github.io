<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ç¬¬ä¸€æœ¬ Docker ä¹¦ | ğŸ”ã®é ˜åŸŸ</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="icon" href="/image/favicon.png">
    <meta name="description" content="ã€€æˆ‘ä»¬ç«‹è¶³äºç¾åˆ©åšåˆä¼—å›½, é’ˆå¯¹å¹´æ»¡18å‘¨å²éå¤§é™†å…¨çƒåäººå¼€å‘, å—åŒ—ç¾æ³•å¾‹ä¿æŠ¤.ã€€ ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€æœªç¶“æˆæ¬Šç¦æ­¢å¤åˆ¶æˆ–å»ºç«‹é•œåƒ. ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€We are based in the United States of America, for over 18 years of age non-mainland Chinese open world, by the North American legal protection. Unauthorized reproduction prohibited or create mirror.">
    <link rel="preload" href="/assets/css/0.styles.eda1073d.css" as="style"><link rel="preload" href="/assets/js/app.5aa78949.js" as="script"><link rel="preload" href="/assets/js/2.db8a1bd9.js" as="script"><link rel="preload" href="/assets/js/36.4c9eea64.js" as="script"><link rel="prefetch" href="/assets/js/10.cb22b5cc.js"><link rel="prefetch" href="/assets/js/11.7fc433a5.js"><link rel="prefetch" href="/assets/js/12.26e9cadb.js"><link rel="prefetch" href="/assets/js/13.1258d0f5.js"><link rel="prefetch" href="/assets/js/14.99ec5e93.js"><link rel="prefetch" href="/assets/js/15.5e075e9b.js"><link rel="prefetch" href="/assets/js/16.3ae89ebf.js"><link rel="prefetch" href="/assets/js/17.a0578cc8.js"><link rel="prefetch" href="/assets/js/18.57573e35.js"><link rel="prefetch" href="/assets/js/19.1921cef9.js"><link rel="prefetch" href="/assets/js/20.21e6a458.js"><link rel="prefetch" href="/assets/js/21.85d787bf.js"><link rel="prefetch" href="/assets/js/22.463f771e.js"><link rel="prefetch" href="/assets/js/23.a24c9494.js"><link rel="prefetch" href="/assets/js/24.4e9dffaf.js"><link rel="prefetch" href="/assets/js/25.48966cca.js"><link rel="prefetch" href="/assets/js/26.79a3a1f7.js"><link rel="prefetch" href="/assets/js/27.d86ae0b6.js"><link rel="prefetch" href="/assets/js/28.3085660e.js"><link rel="prefetch" href="/assets/js/29.b25e9aa3.js"><link rel="prefetch" href="/assets/js/3.bfe9edf0.js"><link rel="prefetch" href="/assets/js/30.32eb4625.js"><link rel="prefetch" href="/assets/js/31.c255a7cd.js"><link rel="prefetch" href="/assets/js/32.d4a5e1b3.js"><link rel="prefetch" href="/assets/js/33.939416f6.js"><link rel="prefetch" href="/assets/js/34.1527656e.js"><link rel="prefetch" href="/assets/js/35.31254244.js"><link rel="prefetch" href="/assets/js/37.dcba8e22.js"><link rel="prefetch" href="/assets/js/38.660f4f18.js"><link rel="prefetch" href="/assets/js/39.36808ac4.js"><link rel="prefetch" href="/assets/js/4.721e6361.js"><link rel="prefetch" href="/assets/js/40.5e3d825d.js"><link rel="prefetch" href="/assets/js/41.8bc35558.js"><link rel="prefetch" href="/assets/js/42.3d9ee979.js"><link rel="prefetch" href="/assets/js/43.d8a9355a.js"><link rel="prefetch" href="/assets/js/44.3b96fdab.js"><link rel="prefetch" href="/assets/js/45.5a397a89.js"><link rel="prefetch" href="/assets/js/46.2c015a12.js"><link rel="prefetch" href="/assets/js/47.cb620ad3.js"><link rel="prefetch" href="/assets/js/48.63e77fd7.js"><link rel="prefetch" href="/assets/js/49.3a1743f4.js"><link rel="prefetch" href="/assets/js/5.9c8aa7de.js"><link rel="prefetch" href="/assets/js/50.858e22ae.js"><link rel="prefetch" href="/assets/js/51.d5ea8da3.js"><link rel="prefetch" href="/assets/js/6.cfcb9227.js"><link rel="prefetch" href="/assets/js/7.7ef2cd09.js"><link rel="prefetch" href="/assets/js/8.8cae79fc.js"><link rel="prefetch" href="/assets/js/9.116ce45e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eda1073d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">ğŸ”ã®é ˜åŸŸ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  ä¸»é¡µ
</a></div><div class="nav-item"><a href="/cs/" class="nav-link">
  è®¡ç®—æœºåŸºç¡€
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  ç½‘ç»œç¼–ç¨‹
</a></div><div class="nav-item"><a href="/server/" class="nav-link">
  åç«¯å¼€å‘
</a></div><div class="nav-item"><a href="/web/" class="nav-link">
  å‰ç«¯å¼€å‘
</a></div><div class="nav-item"><a href="/opensource/" class="nav-link">
  å¼€æºè½¯ä»¶
</a></div><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  è¯»ä¹¦ç¬”è®°
</a></div><div class="nav-item"><a href="/manual/" class="nav-link">
  å¼€å‘æ‰‹å†Œ
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  å…³äº
</a></div> <a href="https://github.com/louistin/blog.liteman.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  ä¸»é¡µ
</a></div><div class="nav-item"><a href="/cs/" class="nav-link">
  è®¡ç®—æœºåŸºç¡€
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  ç½‘ç»œç¼–ç¨‹
</a></div><div class="nav-item"><a href="/server/" class="nav-link">
  åç«¯å¼€å‘
</a></div><div class="nav-item"><a href="/web/" class="nav-link">
  å‰ç«¯å¼€å‘
</a></div><div class="nav-item"><a href="/opensource/" class="nav-link">
  å¼€æºè½¯ä»¶
</a></div><div class="nav-item"><a href="/note/" class="nav-link router-link-active">
  è¯»ä¹¦ç¬”è®°
</a></div><div class="nav-item"><a href="/manual/" class="nav-link">
  å¼€å‘æ‰‹å†Œ
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  å…³äº
</a></div> <a href="https://github.com/louistin/blog.liteman.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/note/" class="sidebar-link">è¯»ä¹¦ç¬”è®°</a></li><li><a href="/note/Linux-UNIX ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œ.html" class="sidebar-link">Linux-UNIX ç³»ç»Ÿç¼–ç¨‹æ‰‹å†Œ</a></li><li><a href="/note/UNIX-LINUX ç¼–ç¨‹å®è·µæ•™ç¨‹.html" class="sidebar-link">UNIX-LINUX ç¼–ç¨‹å®è·µæ•™ç¨‹</a></li><li><a href="/note/TCP-IP è¯¦è§£.html" class="sidebar-link">TCP/IP è¯¦è§£</a></li><li><a href="/note/MySQL å¿…çŸ¥å¿…ä¼š.html" class="sidebar-link">MySQL å¿…çŸ¥å¿…ä¼š</a></li><li><a href="/note/ç¬¬ä¸€æœ¬ Docker ä¹¦.html" class="active sidebar-link">ç¬¬ä¸€æœ¬ Docker ä¹¦</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/ç¬¬ä¸€æœ¬ Docker ä¹¦.html#_01-ç®€ä»‹" class="sidebar-link">01 - ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/note/ç¬¬ä¸€æœ¬ Docker ä¹¦.html#_02-å®‰è£…-docker" class="sidebar-link">02 - å®‰è£… docker</a></li><li class="sidebar-sub-header"><a href="/note/ç¬¬ä¸€æœ¬ Docker ä¹¦.html#_03-docker-å…¥é—¨" class="sidebar-link">03 - docker å…¥é—¨</a></li><li class="sidebar-sub-header"><a href="/note/ç¬¬ä¸€æœ¬ Docker ä¹¦.html#_04-ä½¿ç”¨-docker-é•œåƒå’Œä»“åº“" class="sidebar-link">04 - ä½¿ç”¨ docker é•œåƒå’Œä»“åº“</a></li><li class="sidebar-sub-header"><a href="/note/ç¬¬ä¸€æœ¬ Docker ä¹¦.html#_05-åœ¨æµ‹è¯•ä¸­ä½¿ç”¨-docker" class="sidebar-link">05 - åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ docker</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ç¬¬ä¸€æœ¬-docker-ä¹¦"><a href="#ç¬¬ä¸€æœ¬-docker-ä¹¦" class="header-anchor">#</a> ç¬¬ä¸€æœ¬ Docker ä¹¦</h1> <blockquote><p align="left" style="font-family:Arial;font-size:80%;color:#C0C0C0;">å…¨æ–‡å­—æ•° 2318 words Â |Â  é˜…è¯»æ—¶é—´ 12 mins</p></blockquote> <p></p><div class="table-of-contents"><ul><li><a href="#_01-ç®€ä»‹">01 - ç®€ä»‹</a><ul><li><a href="#docker">Docker</a></li><li><a href="#docker-ç»„ä»¶">Docker ç»„ä»¶</a></li></ul></li><li><a href="#_02-å®‰è£…-docker">02 - å®‰è£… docker</a></li><li><a href="#_03-docker-å…¥é—¨">03 - docker å…¥é—¨</a><ul><li><a href="#äº¤äº’å¼è¿è¡Œå®¹å™¨-interactive-container">äº¤äº’å¼è¿è¡Œå®¹å™¨ interactive container</a></li><li><a href="#å®ˆæŠ¤å¼å®¹å™¨-deamonized-container">å®ˆæŠ¤å¼å®¹å™¨ deamonized container</a></li><li><a href="#å®¹å™¨ç®¡ç†">å®¹å™¨ç®¡ç†</a></li></ul></li><li><a href="#_04-ä½¿ç”¨-docker-é•œåƒå’Œä»“åº“">04 - ä½¿ç”¨ docker é•œåƒå’Œä»“åº“</a><ul><li><a href="#ä»€ä¹ˆæ˜¯-docker-é•œåƒ">ä»€ä¹ˆæ˜¯ docker é•œåƒ</a></li><li><a href="#åˆ—å‡ºé•œåƒ">åˆ—å‡ºé•œåƒ</a></li><li><a href="#æ‹‰å–åŠæŸ¥æ‰¾é•œåƒ">æ‹‰å–åŠæŸ¥æ‰¾é•œåƒ</a></li><li><a href="#æ„å»ºé•œåƒ">æ„å»ºé•œåƒ</a></li></ul></li><li><a href="#_05-åœ¨æµ‹è¯•ä¸­ä½¿ç”¨-docker">05 - åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ docker</a><ul><li><a href="#ä½¿ç”¨-docker-æµ‹è¯•é™æ€ç½‘ç«™">ä½¿ç”¨ docker æµ‹è¯•é™æ€ç½‘ç«™</a></li><li><a href="#ä½¿ç”¨-docker-æ„å»ºå¹¶æµ‹è¯•-web-åº”ç”¨ç¨‹åº">ä½¿ç”¨ Docker æ„å»ºå¹¶æµ‹è¯• Web åº”ç”¨ç¨‹åº</a></li></ul></li></ul></div><p></p> <hr> <h2 id="_01-ç®€ä»‹"><a href="#_01-ç®€ä»‹" class="header-anchor">#</a> 01 - ç®€ä»‹</h2> <h3 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h3> <ul><li>Docker é¼“åŠ±é¢å‘æœåŠ¡çš„æ¶æ„å’Œå¾®æœåŠ¡æ¶æ„, å•ä¸ªå®¹å™¨åªè¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ–è¿›ç¨‹</li></ul> <h3 id="docker-ç»„ä»¶"><a href="#docker-ç»„ä»¶" class="header-anchor">#</a> Docker ç»„ä»¶</h3> <ul><li>docker å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨
<ul><li>docker æ˜¯ä¸€ä¸ª C/S æ¶æ„ç¨‹åº</li> <li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨æˆ–å®ˆæŠ¤è¿›ç¨‹å‘é€è¯·æ±‚, ç”±å…¶å®Œæˆæ‰€æœ‰å·¥ä½œå¹¶è¿”å›ç»“æœ</li></ul></li> <li>docker é•œåƒ
<ul><li>ç”Ÿå‘½å‘¨æœŸä¸­<strong>æ„å»º</strong>é˜¶æ®µ</li> <li>å®¹å™¨çš„æºä»£ç </li></ul></li> <li>Registry
<ul><li>ä¿å­˜ç”¨æˆ·æ„å»ºçš„é•œåƒ</li> <li>åˆ†ä¸ºå…±æœ‰å’Œç§æœ‰</li></ul></li> <li>docker å®¹å™¨
<ul><li>ç”Ÿå‘½å‘¨æœŸä¸­<strong>å¯åŠ¨</strong>é˜¶æ®µ</li> <li>å®¹å™¨åŸºäºé•œåƒå¯åŠ¨èµ·æ¥çš„</li></ul></li></ul> <h2 id="_02-å®‰è£…-docker"><a href="#_02-å®‰è£…-docker" class="header-anchor">#</a> 02 - å®‰è£… docker</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># kernel &gt; 3.8</span>
yum update
yum remove docker  docker-common docker-selinux docker-engine
yum <span class="token function">install</span> -y yum-utils device-mapper-persistent-data lvm2

<span class="token comment"># åŠ è½½ device mapper æ¨¡å—, device-mapper ä½œä¸ºå­˜å‚¨é©±åŠ¨</span>
<span class="token comment"># ls -l /sys/class/misc/device-mapper/ æˆ– grep device-mapper /proc/devices æŸ¥çœ‹</span>
modeprobe dm_mod

yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
<span class="token comment"># ç›´æ¥ä½¿ç”¨ yum install -y docker å®‰è£…çš„ç‰ˆæœ¬ä¸æ˜¯æœ€æ–°</span>
yum <span class="token function">install</span> -y docker-ce
docker info

systemctl <span class="token builtin class-name">enable</span> docker
systemctl start/stop/restart docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_03-docker-å…¥é—¨"><a href="#_03-docker-å…¥é—¨" class="header-anchor">#</a> 03 - docker å…¥é—¨</h2> <h3 id="äº¤äº’å¼è¿è¡Œå®¹å™¨-interactive-container"><a href="#äº¤äº’å¼è¿è¡Œå®¹å™¨-interactive-container" class="header-anchor">#</a> äº¤äº’å¼è¿è¡Œå®¹å™¨ interactive container</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># -i ä¿è¯å®¹å™¨ä¸­çš„ STDIN å¼€å¯</span>
<span class="token comment"># -t ä¸ºè¦åˆ›å»ºçš„å®¹å™¨åˆ†é…ä¸€ä¸ªä¼ª tty ç»ˆç«¯</span>
<span class="token comment"># ubuntu é•œåƒåç§°, è¿™é‡Œä¸ºåŸºç¡€é•œåƒ</span>
<span class="token comment"># /bin/bash å®¹å™¨ä¸­è¿è¡Œçš„å‘½ä»¤</span>
<span class="token punctuation">[</span>louis@louis ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> docker run --name ubuntu_20.04 -i -t ubuntu /bin/bash
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> louis:
Unable to <span class="token function">find</span> image <span class="token string">'ubuntu:latest'</span> locally
latest: Pulling from library/ubuntu
d51af753c3d3: Pull complete
fc878cd0a91c: Pull complete
6154df8ff988: Pull complete
fee5db0ff82f: Pull complete
Digest: sha256:747d2dbbaaee995098c9792d99bd333c6783ce56150d1b11e333bbceed5c54d7
Status: Downloaded newer image <span class="token keyword">for</span> ubuntu:latest
root@30a9c7599262:/<span class="token comment"># uname -r</span>
<span class="token number">4.4</span>.223-1.el7.elrepo.x86_64
root@30a9c7599262:/etc/apt<span class="token comment"># cat /etc/lsb-release</span>
<span class="token assign-left variable">DISTRIB_ID</span><span class="token operator">=</span>Ubuntu
<span class="token assign-left variable">DISTRIB_RELEASE</span><span class="token operator">=</span><span class="token number">20.04</span>
<span class="token assign-left variable">DISTRIB_CODENAME</span><span class="token operator">=</span>focal
<span class="token assign-left variable">DISTRIB_DESCRIPTION</span><span class="token operator">=</span><span class="token string">&quot;Ubuntu 20.04 LTS&quot;</span>

<span class="token comment"># æ›¿æ¢æº</span>
root@30a9c7599262:/etc/apt<span class="token comment"># sed -i s@/security.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list</span>
root@30a9c7599262:/etc/apt<span class="token comment"># sed -i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list</span>
<span class="token function">apt</span> clean <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt</span> upgrade
<span class="token function">apt</span> <span class="token function">install</span> <span class="token function">vim</span> net-tools

root@30a9c7599262:~<span class="token comment"># exit</span>
<span class="token builtin class-name">exit</span>
<span class="token punctuation">[</span>louis@louis ~<span class="token punctuation">]</span>$

<span class="token comment"># CONTAINER ID å’Œ NAMES éƒ½å¯ä»¥å”¯ä¸€æ ‡è¯†å®¹å™¨</span>
<span class="token punctuation">[</span>root@louis ~<span class="token punctuation">]</span><span class="token comment"># sudo docker ps -a</span>
CONTAINER ID    IMAGE   COMMAND       CREATED         STATUS        PORTS      NAMES
5e01a9401a5d    ubuntu  <span class="token string">&quot;/bin/bash&quot;</span>   <span class="token number">4</span> minutes ago   Up <span class="token number">2</span> seconds             ubuntu_20.04

<span class="token comment"># æ˜¾ç¤ºæœ€å 10 ä¸ªå®¹å™¨</span>
<span class="token function">sudo</span> docker <span class="token function">ps</span> -n <span class="token number">10</span>

<span class="token comment"># é™„ç€åˆ°docer, shell é€€å‡º container éšä¹‹ stop</span>
<span class="token punctuation">[</span>louis@louis ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> docker attach ubuntu_20.04
root@5e01a9401a5d:/<span class="token comment">#</span>

<span class="token comment"># å®¹å™¨ç®¡ç†</span>
<span class="token function">sudo</span> docker start/stop/restart ubuntu_20.04
<span class="token function">sudo</span> docker <span class="token function">rm</span> ubuntu_20.04
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h3 id="å®ˆæŠ¤å¼å®¹å™¨-deamonized-container"><a href="#å®ˆæŠ¤å¼å®¹å™¨-deamonized-container" class="header-anchor">#</a> å®ˆæŠ¤å¼å®¹å™¨ deamonized container</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>louis@louis ~<span class="token punctuation">]</span><span class="token comment"># sudo docker run --name daemon_dave -d ubuntu /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</span>
740f6405a0a87c2d7fdf20c902304ff3da3748f09f360f52a00e9a9d84db1565

<span class="token comment"># æŸ¥çœ‹æ—¥å¿—</span>
<span class="token function">sudo</span> docker logs -f daemon_dave
<span class="token function">sudo</span> docker logs --tail <span class="token number">10</span> daemon_dave  <span class="token comment"># æœ€æ–°10æ¡</span>
<span class="token function">sudo</span> docker logs --tail <span class="token number">0</span> -ft daemon_dave <span class="token comment"># æœ€æ–°å¸¦æ—¶é—´æˆ³</span>

<span class="token comment"># æŸ¥çœ‹è¿›ç¨‹</span>
<span class="token function">sudo</span> docker <span class="token function">top</span> daemon_dave

<span class="token comment"># åœ¨å®¹å™¨å†…éƒ¨è¿è¡Œè¿›ç¨‹</span>
<span class="token function">sudo</span> docker <span class="token builtin class-name">exec</span> -t -i daemon_dave <span class="token function">touch</span> /root/new_file
<span class="token comment"># åœ¨å®¹å™¨ä¸­å¯åŠ¨ shell</span>
<span class="token function">sudo</span> docker <span class="token builtin class-name">exec</span> -t -i daemon_dave /bin/bash

<span class="token comment"># å®¹å™¨ç®¡ç†</span>
<span class="token function">sudo</span> docker <span class="token function">kill</span> daemon_dave    <span class="token comment"># å¿«é€Ÿåœæ­¢, å…¶ä»–åŒä¸Š</span>
<span class="token comment"># æ— è®ºå®¹å™¨é€€å‡ºç æ˜¯ä»€ä¹ˆ, éƒ½ä¼šè‡ªåŠ¨é‡å¯å®¹å™¨</span>
<span class="token function">sudo</span> docker run --restart<span class="token operator">=</span>always --name daemon_dave -d ubuntu /bin/sh -c <span class="token string">&quot;echo hello world&quot;</span>
<span class="token comment"># åªæœ‰å½“é€€å‡ºç é 0 æ—¶æ‰é‡å¯, æœ€å¤šé‡å¯ 5 æ¬¡</span>
<span class="token function">sudo</span> docker run --restart<span class="token operator">=</span>on-failure:5 --name daemon_dave -d ubuntu /bin/sh -c <span class="token string">&quot;echo hello world&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="å®¹å™¨ç®¡ç†"><a href="#å®¹å™¨ç®¡ç†" class="header-anchor">#</a> å®¹å™¨ç®¡ç†</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># å®¹å™¨è¯¦ç»†ä¿¡æ¯</span>
<span class="token function">sudo</span> docker inspect daemon_dave
<span class="token comment"># é€‰å®šæŸ¥çœ‹ç»“æœ</span>
<span class="token function">sudo</span> docker inspect daemon_dave --format <span class="token string">'{{ .NetworkSettings.IPAddress }}'</span>

<span class="token comment"># åˆ é™¤æ‰€æœ‰å®¹å™¨</span>
<span class="token function">sudo</span> docker <span class="token function">rm</span> <span class="token variable"><span class="token variable">`</span><span class="token function">sudo</span> docker <span class="token function">ps</span> -a -q<span class="token variable">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_04-ä½¿ç”¨-docker-é•œåƒå’Œä»“åº“"><a href="#_04-ä½¿ç”¨-docker-é•œåƒå’Œä»“åº“" class="header-anchor">#</a> 04 - ä½¿ç”¨ docker é•œåƒå’Œä»“åº“</h2> <h3 id="ä»€ä¹ˆæ˜¯-docker-é•œåƒ"><a href="#ä»€ä¹ˆæ˜¯-docker-é•œåƒ" class="header-anchor">#</a> ä»€ä¹ˆæ˜¯ docker é•œåƒ</h3> <ul><li>docker é•œåƒæ˜¯ç”±æ–‡ä»¶ç³»ç»Ÿå åŠ è€Œæˆ</li> <li>docker ä¸­, root æ–‡ä»¶ç³»ç»Ÿæ°¸è¿œåªèƒ½æ˜¯åªè¯»çŠ¶æ€</li> <li>docker åˆ©ç”¨è”åˆåŠ è½½ union mount æŠ€æœ¯åœ¨ root æ–‡ä»¶ç³»ç»Ÿå±‚ä¸ŠåŠ è½½æ›´å¤šçš„åªè¯»æ–‡ä»¶ç³»ç»Ÿ
<ul><li>è”åˆåŠ è½½ä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿ, ä½†æ˜¯å¤–é¢åªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ</li> <li>è”åˆåŠ è½½å°†å„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ åœ¨ä¸€èµ·, æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½•</li></ul></li> <li>å†™æ—¶å¤åˆ¶ copy on write
<ul><li>åˆ›å»ºæ–°å®¹å™¨æ—¶, docker ä¼šæ„å»ºå‡ºä¸€ä¸ªé•œåƒæ ˆ, å¹¶åœ¨æ ˆçš„æœ€é¡¶å±‚æ·»åŠ ä¸€ä¸ªè¯»å†™å±‚</li> <li>è¿™ä¸ªè¯»å†™å±‚åŠå…¶ä¸‹é¢çš„é•œåƒå±‚ä»¥åŠä¸€äº›é…ç½®æ•°æ®, å°±æ„æˆä¸€ä¸ªå®¹å™¨</li></ul></li></ul> <p><strong>Docker æ–‡ä»¶ç³»ç»Ÿå±‚</strong><br> <img src="/image/note/thedockerbook/04_001_dockeræ–‡ä»¶ç³»ç»Ÿå±‚.webp" alt="Docker æ–‡ä»¶ç³»ç»Ÿå±‚"></p> <h3 id="åˆ—å‡ºé•œåƒ"><a href="#åˆ—å‡ºé•œåƒ" class="header-anchor">#</a> åˆ—å‡ºé•œåƒ</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>louis@louis ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
ubuntu              latest              1d622ef86b13        <span class="token number">2</span> weeks ago         <span class="token number">73</span>.9MB

<span class="token comment"># æŒ‡å®š tag å¯åŠ¨å®¹å™¨</span>
<span class="token function">sudo</span> docker run -t -i --name new_container ubuntu:latest /bin/bash

<span class="token comment"># æœ¬åœ°é•œåƒä¿å­˜è·¯å¾„ /var/lib/docker</span>
<span class="token comment"># å®¹å™¨è·¯å¾„ /var/lib/docker/containers</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="æ‹‰å–åŠæŸ¥æ‰¾é•œåƒ"><a href="#æ‹‰å–åŠæŸ¥æ‰¾é•œåƒ" class="header-anchor">#</a> æ‹‰å–åŠæŸ¥æ‰¾é•œåƒ</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># é»˜è®¤æ‹‰å– latest ç‰ˆæœ¬, å¯æ·»åŠ  tag æ‹‰å–æŒ‡å®šç‰ˆæœ¬</span>
<span class="token function">sudo</span> docker pull IMAGE_NAME:TAG

<span class="token comment"># OFFICIAL å®˜æ–¹æ„å»º</span>
<span class="token function">sudo</span> docker search IMAGE_NAME:TAG
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="æ„å»ºé•œåƒ"><a href="#æ„å»ºé•œåƒ" class="header-anchor">#</a> æ„å»ºé•œåƒ</h3> <ul><li><p>ä½¿ç”¨ <code>commit</code> æ„å»º</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> docker run -it ubuntu:latest /bin/bash
root@bdcfd6b79a7f:/<span class="token comment"># apt -y update &amp;&amp; apt install -y apache2</span>
<span class="token comment"># è·å– CONTAINER ID</span>
<span class="token punctuation">[</span>louis@louis ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> docker <span class="token function">ps</span> -l -q
bdcfd6b79a7f

<span class="token comment"># åˆ›å»ºé•œåƒ</span>
<span class="token function">sudo</span> docker commit -m<span class="token operator">=</span><span class="token string">&quot;A new custom image&quot;</span> --author<span class="token operator">=</span><span class="token string">&quot;louis&quot;</span> bdcfd6b79a7f louis/apache2:webserver

<span class="token comment"># æŸ¥çœ‹</span>
<span class="token function">sudo</span> docker images

<span class="token comment"># è¿è¡Œ</span>
<span class="token function">sudo</span> docker run -it louis/apache2:webserver /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>ä½¿ç”¨ Dcokerfile æ„å»º</p> <ul><li>Dockerfile æ‰§è¡Œæµç¨‹
<ul><li>Docker ä»åŸºç¡€é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨</li> <li>æ‰§è¡Œä¸€æ¡æŒ‡ä»¤, å¯¹å®¹å™¨åšå‡ºä¿®æ”¹</li> <li>æ‰§è¡Œç±»ä¼¼ <code>docker commit</code> çš„æ“ä½œ, æäº¤ä¸€ä¸ªæ–°çš„é•œåƒå±‚</li> <li>docker åŸºäºåˆšæäº¤çš„é•œåƒè¿è¡Œä¸€ä¸ªæ–°å®¹å™¨</li> <li>æ‰§è¡Œ Dockerfile çš„ä¸‹ä¸€æ¡æŒ‡ä»¤, ç›´åˆ°æ‰€æœ‰æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•</li></ul></li> <li>docker æ„å»ºé•œåƒè¿‡ç¨‹ä¸­ä¼šå°†ä¹‹å‰çš„é•œåƒå±‚è§†ä¸ºç¼“å­˜, å†æ¬¡æ„å»ºæ—¶ä¼šä»æœ€æ–°ä¿®æ”¹çš„æŒ‡ä»¤å¤„å¼€å§‹æ‰§è¡Œ</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># åˆ›å»ºç›®å½• static_web, å¹¶åœ¨å…¶ä¸­åˆ›å»ºæ–‡ä»¶ Dockerfile</span>
<span class="token comment"># Dockerfile å¦‚ä¸‹</span>
<span class="token comment"># æ„å»º</span>
<span class="token comment"># --no-cache ç•¥è¿‡ç¼“å­˜åŠŸèƒ½</span>
<span class="token function">sudo</span> docker build -t<span class="token operator">=</span><span class="token string">&quot;louis/static_web:v0.0.1&quot;</span> <span class="token builtin class-name">.</span>
<span class="token comment"># æŸ¥çœ‹æ„å»ºè¿‡ç¨‹</span>
<span class="token function">sudo</span> docker histoty IMAGE_ID

<span class="token comment"># å¯åŠ¨</span>
<span class="token comment"># -d ä»¥åˆ†ç¦» detached çš„æ–¹å¼åœ¨åå°å¯åŠ¨</span>
<span class="token comment"># -p docker è¿è¡Œæ—¶å…¬å¼€ç«¯å£ç»™å¤–éƒ¨å®¿ä¸»æœº, é»˜è®¤è‡ªåŠ¨åˆ†é…, å¯ä»¥ç»‘å®šIP:PORT</span>
<span class="token comment"># -P åæ— éœ€æŒ‡å®šç«¯å£, è‡ªåŠ¨å…¬å¼€æ‰€æœ‰ EXPOSE ç«¯å£</span>
<span class="token comment"># nginx -g &quot;daemon off;&quot; ä»¥å‰å°æ–¹å¼å¯åŠ¨ nginx</span>
<span class="token function">sudo</span> docker run -d -p <span class="token number">127.0</span>.0.1::80 --name static_web louis/static_web:v0.0.1 nginx -g <span class="token string">&quot;daemon off;&quot;</span>

<span class="token comment"># æŸ¥çœ‹å®¿ä¸»æœºæ˜ å°„ç«¯å£</span>
<span class="token punctuation">[</span>louis@louis static_web<span class="token punctuation">]</span>$ <span class="token function">sudo</span> docker <span class="token function">ps</span>
CONTAINER ID        IMAGE                     COMMAND                  CREATED             STATUS              PORTS                     NAMES
708aca0da6b4        louis/static_web:v0.0.1   <span class="token string">&quot;nginx -g 'daemon ofâ€¦&quot;</span>   <span class="token number">14</span> seconds ago      Up <span class="token number">13</span> seconds       <span class="token number">127.0</span>.0.1:32769-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   static_web

<span class="token punctuation">[</span>louis@louis static_web<span class="token punctuation">]</span>$ <span class="token function">sudo</span> docker port CONTAINER_ID <span class="token number">80</span>
<span class="token number">127.0</span>.0.1:32769
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># Version: 0.0.1</span>
<span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>20.04
<span class="token keyword">MAINTAINER</span> Louis Tian <span class="token string">&quot;louis.tianlu@gmail.com&quot;</span>
<span class="token keyword">RUN</span> sed <span class="token punctuation">-</span>i s@/security.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list
<span class="token keyword">RUN</span> sed <span class="token punctuation">-</span>i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list
<span class="token comment"># ä¿®æ”¹æ—¶é—´æˆ³, å‰é¢çš„ç¼“å­˜å‘½ä¸­, åé¢çš„æŒ‡ä»¤å°†ä¼šé‡æ–°æ‰§è¡Œ</span>
<span class="token keyword">ENV</span> REFRESHED_AT 2020<span class="token punctuation">-</span>05<span class="token punctuation">-</span>13
<span class="token comment"># RUN æŒ‡ä»¤ä¼šåœ¨shell ä¸­ä½¿ç”¨ /bin/sh -c æ‰§è¡Œ</span>
<span class="token comment"># å…¶ä»–æ–¹å¼ exec æ ¼å¼: RUN [</span><span class="token string">&quot;apt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; install&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-y&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;nginx&quot;</span><span class="token punctuation">]</span>
<span class="token keyword">RUN</span> apt update
<span class="token keyword">RUN</span> apt install <span class="token punctuation">-</span>y nginx
<span class="token keyword">RUN</span> echo <span class="token string">'Hi, I am in your container'</span> <span class="token punctuation">&gt;</span> /var/www/html/index.nginx<span class="token punctuation">-</span>debian.html
<span class="token comment"># æŒ‡å®šç«¯å£</span>
<span class="token keyword">EXPOSE</span> 80
<span class="token keyword">ONBUILD</span> <span class="token keyword">ADD</span> . /app/src
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li> <li><p>Dockerfile æŒ‡ä»¤</p> <ul><li><p><code>CMD</code></p> <ul><li>æŒ‡å®šå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤</li> <li><code>docker run</code> å‘½ä»¤ä¼šè¦†ç›– <code>CMD</code> å‘½ä»¤</li> <li>Dockerfile ä¸­åªèƒ½æŒ‡å®šä¸€æ¡ CMD, å¤šæ¡åªæœ‰æœ€åä¸€æ¡æœ‰æ•ˆ, å¯ä»¥ç»“åˆ Supervisor ç®¡ç†å¤šè¿›ç¨‹</li></ul></li> <li><p><code>ENTRYPOINT</code></p> <ul><li>ä¸ä¼šè¢« <code>docker run</code> å‘½ä»¤è¦†ç›–</li> <li><code>docker run --entrypoint</code> å¯è¦†ç›– <code>ENTRYPOINT</code></li></ul></li> <li><p><code>WORKDIR</code></p> <ul><li>ä»é•œåƒåˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨æ—¶, åœ¨å®¹å™¨å†…éƒ¨è®¾ç½®ä¸€ä¸ªå·¥ä½œç›®å½•(åŒæ—¶åˆ‡åˆ°è¯¥ç›®å½•), <code>ENCRYPOINT</code>,
<code>/</code>, <code>CMD</code> æŒ‡å®šçš„ç¨‹åºåœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œ</li> <li>å¯ä»¥å¤šæ¬¡æ‰§è¡Œ, æ¯æ¬¡æ‰§è¡Œå°±ä¼šåˆ‡æ¢åˆ°å¯¹åº”ç›®å½•, åç»­å‘½ä»¤éƒ½åœ¨è¯¥ç›®å½•æ‰§è¡Œ</li> <li><code>docker run -w</code> å¯è¦†ç›– <code>WORKDIR</code></li></ul></li> <li><p><code>ENV</code></p> <ul><li>åœ¨é•œåƒæ„å»ºè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡, æŒä¹…ä¿å­˜</li> <li>æ–°çš„ç¯å¢ƒå˜é‡å¯ä»¥åœ¨åç»­ä»»ä½• RUN æŒ‡ä»¤ä¸­ä½¿ç”¨</li> <li><code>docker run -e</code> æ—¨åœ¨è¿è¡Œæ—¶æœ‰æ•ˆ</li></ul></li> <li><p><code>USER</code></p> <ul><li>æŒ‡å®šé•œåƒä¼šä»¥ä»€ä¹ˆæ ·çš„ç”¨æˆ·å»è¿è¡Œ</li> <li><code>docker run -u</code> è¦†ç›–è¯¥å€¼</li> <li>ä¸æŒ‡å®šé»˜è®¤ä¸º root</li></ul></li> <li><p><code>VOLUME</code></p> <ul><li>å‘åŸºäºé•œåƒåˆ›å»ºçš„å®¹å™¨æ·»åŠ å·, ä¸€ä¸ªå·å¯ä»¥å­˜åœ¨ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨å†…çš„ç‰¹å®šç›®å½•</li></ul></li> <li><p><code>ADD</code></p> <ul><li>å°†æ„å»ºç¯å¢ƒä¸‹çš„æ–‡ä»¶å’Œç›®å½•å¤åˆ¶åˆ°é•œåƒä¸­, å·²å­˜åœ¨ä¸ä¼šè¦†ç›–, ç›®çš„è·¯å¾„ä¸å…¨ä¼šè‡ªåŠ¨åˆ›å»º</li> <li>æ–‡ä»¶æºä¹Ÿå¯ä»¥ä½¿ç”¨ URL</li> <li>gzip bzip2 xz æ–‡ä»¶æ·»åŠ æ—¶ä¼šè‡ªåŠ¨ unpack</li> <li>åç»­æŒ‡ä»¤æ„å»ºç¼“å­˜å¤±æ•ˆ</li></ul></li> <li><p><code>COPY</code></p> <ul><li>åªå…³å¿ƒæ–‡ä»¶å¤åˆ¶, ä¸åšæå–å’Œè§£å‹</li> <li>æœ¬åœ°æ–‡ä»¶å¿…é¡»åœ¨ Dockerfile åŒä¸€ç›®å½•</li></ul></li> <li><p><code>ONBUILD</code></p> <ul><li>ä¸ºé•œåƒæ·»åŠ è§¦å‘å™¨ trigger, å½“ä¸€ä¸ªé•œåƒè¢«ç”¨ä½œå…¶ä»–é•œåƒçš„åŸºç¡€é•œåƒæ—¶, è¯¥é•œåƒçš„è§¦å‘å™¨ä¼šè¢«æ‰§è¡Œ</li> <li>æ„å»ºæ—¶, ä¼šåœ¨ <code>FROM</code> åç«‹å³æ‰§è¡Œ</li> <li>åªä¼šè¢«å­é•œåƒç»§æ‰¿ä¸€æ¬¡, ä¸èƒ½ç»§ç»­è¢«å­™é•œåƒç»§æ‰¿</li> <li>ä¸èƒ½ä½¿ç”¨æŒ‡ä»¤ <code>FROM</code> <code>MAINTAINER</code> <code>ONBUILD</code></li> <li><code>sudo docker inspect CONTAINER_ID</code> æŸ¥çœ‹</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># sudo docker run -i -t louis/static_web ä¸éœ€è¦å†æŒ‡å®š /bin/bash, å¹¶ä¼ å…¥ -l å‚æ•°</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span>, <span class="token string">&quot;-l&quot;</span><span class="token punctuation">]</span>
ENCRYPONIT <span class="token punctuation">[</span><span class="token string">&quot;/usr/sbin/nginx&quot;</span>, <span class="token string">&quot;-g&quot;</span>, <span class="token string">&quot;daemon off;&quot;</span><span class="token punctuation">]</span>

<span class="token comment"># ç»„åˆ CMD ENCRYPOINT, å¯åœ¨ docker run æ—¶çµæ´»ä¼ å…¥å‚æ•°</span>
ENCRYPONIT <span class="token punctuation">[</span><span class="token string">&quot;/usr/sbin/nginx&quot;</span><span class="token punctuation">]</span>
CMD <span class="token punctuation">[</span><span class="token string">&quot;-h&quot;</span><span class="token punctuation">]</span>

WORKDIR /opt/nginx/conf
RUN <span class="token function">mkdir</span> conf.d
WORKDIR /opt/nginx/conf/conf.d
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">&quot;touch louis.com.conf&quot;</span><span class="token punctuation">]</span>

ENV RVM_PATH /home/rvm
RUN gem <span class="token function">install</span> unicorn

<span class="token comment"># docker run -e &quot;TARGET_PATH=/opt/app&quot; åªåœ¨è¿è¡Œæ—¶æœ‰æ•ˆ</span>
ENV TARGET_PATH /opt/app
WORKDIR <span class="token variable">$TARGET_PATH</span>   <span class="token comment"># WORKDIR å€¼è®¾ç½®ä¸º /opt/app</span>

<span class="token environment constant">USER</span> nginx

<span class="token comment"># ä¸ºåŸºäºæ­¤é•œåƒåˆ›å»ºçš„å®¹å™¨åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªæŒ‚è½½ç‚¹</span>
VOLUME <span class="token punctuation">[</span><span class="token string">&quot;opt/project&quot;</span>, <span class="token string">&quot;/data&quot;</span><span class="token punctuation">]</span>

ADD software.lic /opt/application/software.lic

COPY conf.d /etc/apache2/

ONBUILD ADD <span class="token builtin class-name">.</span> /app/src
ONBUILD RUN <span class="token builtin class-name">cd</span> /app/src <span class="token operator">&amp;&amp;</span> <span class="token function">make</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div></li></ul></li> <li><p>é•œåƒæ¨é€åˆ° Docker hub</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> docker login
<span class="token function">sudo</span> docker tag IMAGE_ID DOCKERHUB_USRNAME/IMAGE_NAME:TAG
<span class="token function">sudo</span> docker push DOCKERHUB_USRNAME/IMAGE_NAME:TAG
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>åˆ é™¤é•œåƒ</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> docker rmi IMAGE_NAME
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h2 id="_05-åœ¨æµ‹è¯•ä¸­ä½¿ç”¨-docker"><a href="#_05-åœ¨æµ‹è¯•ä¸­ä½¿ç”¨-docker" class="header-anchor">#</a> 05 - åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ docker</h2> <h3 id="ä½¿ç”¨-docker-æµ‹è¯•é™æ€ç½‘ç«™"><a href="#ä½¿ç”¨-docker-æµ‹è¯•é™æ€ç½‘ç«™" class="header-anchor">#</a> ä½¿ç”¨ docker æµ‹è¯•é™æ€ç½‘ç«™</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># æ„å»ºç›®å½•</span>
<span class="token punctuation">[</span>louis@louis sample<span class="token punctuation">]</span>$ tree
<span class="token builtin class-name">.</span>
<span class="token operator">|</span>-- Dockerfile
<span class="token operator">|</span>-- nginx
<span class="token operator">|</span>   <span class="token operator">|</span>-- global.conf
<span class="token operator">|</span>   <span class="token variable"><span class="token variable">`</span>-- nginx.conf
<span class="token variable">`</span></span>-- website
    `-- index.html

<span class="token comment"># æ„å»ºä¸è¿è¡Œ</span>
<span class="token function">sudo</span> docker build -t louistian/nginx <span class="token builtin class-name">.</span>

<span class="token punctuation">[</span>louis@louis sample<span class="token punctuation">]</span>$ <span class="token function">sudo</span> docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
louistian/nginx     latest              3fdba3a08ccb        <span class="token number">20</span> minutes ago      510MB
centos              <span class="token number">7</span>                   b5b4d78bc90c        <span class="token number">8</span> days ago          203MB

<span class="token comment"># -v å°†å®¿ä¸»æœº website/ ä½œä¸ºå·, æŒ‚è½½åˆ°å®¹å™¨ä¸­</span>
<span class="token comment"># å·çš„ä¿®æ”¹ä¼šç›´æ¥ç”Ÿæ•ˆ, æäº¤æˆ–åˆ›å»ºé•œåƒæ—¶, å·ä¸è¢«åŒ…å«åœ¨é•œåƒä¸­. å®¹å™¨åœæ­¢, å·å†…å®¹ä¾ç„¶å­˜åœ¨</span>
<span class="token function">sudo</span> docker run -d -p <span class="token number">80</span> --name website -v <span class="token environment constant">$PWD</span>/website:/var/www/html/website louistian/nginx nginx

<span class="token punctuation">[</span>louis@louis sample<span class="token punctuation">]</span>$ <span class="token function">sudo</span> docker <span class="token function">ps</span> -l
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                   NAMES
2e41582b07fa        louistian/nginx     <span class="token string">&quot;nginx&quot;</span>             <span class="token number">18</span> minutes ago      Up <span class="token number">18</span> minutes       <span class="token number">0.0</span>.0.0:32780-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   website
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># Dockerfile VERSION: 0.0.1</span>
<span class="token keyword">FROM</span> centos<span class="token punctuation">:</span>7
<span class="token keyword">MAINTAINER</span> Louis <span class="token string">&quot;louis.tianlu@gmail.com&quot;</span>
<span class="token keyword">ENV</span> REFRESHED_AT 2020<span class="token punctuation">-</span>05<span class="token punctuation">-</span>14
<span class="token keyword">RUN</span> yum update <span class="token punctuation">-</span>y
<span class="token keyword">RUN</span> yum install epel<span class="token punctuation">-</span>release <span class="token punctuation">-</span>y
<span class="token keyword">RUN</span> yum install nginx <span class="token punctuation">-</span>y
<span class="token keyword">RUN</span> mkdir <span class="token punctuation">-</span>p /var/www/html
<span class="token comment"># ä¸åŒé£æ ¼çš„å¤åˆ¶</span>
<span class="token keyword">ADD</span> nginx/global.conf /etc/nginx/conf.d/
<span class="token keyword">ADD</span> nginx/nginx.conf /etc/nginx/nginx.conf
<span class="token keyword">EXPOSE</span> 80
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># global.conf</span>
server <span class="token punctuation">{</span>
  listen          <span class="token number">0.0</span>.0.0:80<span class="token punctuation">;</span>
  server_name     _<span class="token punctuation">;</span>

  root            /var/www/html/website<span class="token punctuation">;</span>
  index           index.html index.htm<span class="token punctuation">;</span>

  access_log      /var/log/nginx/default_accesss.log<span class="token punctuation">;</span>
  error_log       /var/log/nginx/default_error.log<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># nginx.conf</span>
user root<span class="token punctuation">;</span>
worker_processes <span class="token number">2</span><span class="token punctuation">;</span>
pid /run/nginx.pid<span class="token punctuation">;</span>
daemon off<span class="token punctuation">;</span>   <span class="token comment"># nginx å¼ºåˆ¶å‰å°è¿è¡Œ, è¿›ç¨‹ä¸ä¸­æ–­, ä¿æŒå®¹å™¨æ´»è·ƒçŠ¶æ€</span>

events <span class="token punctuation">{</span><span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    sendfile on<span class="token punctuation">;</span>
    tcp_nopush on<span class="token punctuation">;</span>
    tcp_nodelay on<span class="token punctuation">;</span>
    keepalive_timeout <span class="token number">65</span><span class="token punctuation">;</span>
    types_hash_max_size <span class="token number">2048</span><span class="token punctuation">;</span>
    include /etc/nginx/mime.types<span class="token punctuation">;</span>
    default_type application/octet-stream<span class="token punctuation">;</span>
    access_log /var/log/nginx/access.log<span class="token punctuation">;</span>
    error_log /var/log/nginx/error.log<span class="token punctuation">;</span>
    <span class="token function">gzip</span> on<span class="token punctuation">;</span>
    gzip_disable <span class="token string">&quot;msie6&quot;</span><span class="token punctuation">;</span>
    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- index.html --&gt;</span>
Hello World.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
louis.tianlu@gmail.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="ä½¿ç”¨-docker-æ„å»ºå¹¶æµ‹è¯•-web-åº”ç”¨ç¨‹åº"><a href="#ä½¿ç”¨-docker-æ„å»ºå¹¶æµ‹è¯•-web-åº”ç”¨ç¨‹åº" class="header-anchor">#</a> ä½¿ç”¨ Docker æ„å»ºå¹¶æµ‹è¯• Web åº”ç”¨ç¨‹åº</h3> <h4 id="æ„å»º-sinatra-é•œåƒä¸å®¹å™¨"><a href="#æ„å»º-sinatra-é•œåƒä¸å®¹å™¨" class="header-anchor">#</a> æ„å»º sinatra é•œåƒä¸å®¹å™¨</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># æ·»åŠ  webapp ç›®å½•, å¹¶ç¡®ä¿ webapp/bin/webapp æƒé™å¯æ‰§è¡Œ</span>
<span class="token punctuation">[</span>louis@louis sinatra<span class="token punctuation">]</span>$ tree
<span class="token builtin class-name">.</span>
<span class="token operator">|</span>-- Dockerfile
<span class="token variable"><span class="token variable">`</span>-- webapp
    <span class="token operator">|</span>-- bin
    <span class="token operator">|</span>   <span class="token variable">`</span></span>-- webapp
    <span class="token operator">|</span>-- Dockerfile
    <span class="token variable"><span class="token variable">`</span>-- lib
        <span class="token variable">`</span></span>-- app.rb

<span class="token function">sudo</span> docker build -t louistian/sinatra <span class="token builtin class-name">.</span>
<span class="token function">sudo</span> docker run -d -p <span class="token number">4567</span> --name webapp -v <span class="token environment constant">$PWD</span>/webapp:/opt/webapp louistian/sinatra

<span class="token comment"># docker logs ç±»ä¼¼ tail</span>
<span class="token function">sudo</span> docker logs webapp
<span class="token function">sudo</span> docker logs -f webapp

<span class="token function">sudo</span> docker <span class="token function">top</span> webapp
<span class="token function">sudo</span> docker port webapp <span class="token number">4567</span>

<span class="token punctuation">[</span>louis@louis sinatra<span class="token punctuation">]</span>$ <span class="token function">curl</span> -i -H <span class="token string">'Accept: application/json'</span> -d <span class="token string">'name=louis&amp;status=online'</span> http://localhost:32781/json
HTTP/1.1 <span class="token number">200</span> OK
Content-Type: text/html<span class="token punctuation">;</span><span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
Content-Length: <span class="token number">34</span>
X-Xss-Protection: <span class="token number">1</span><span class="token punctuation">;</span> <span class="token assign-left variable">mode</span><span class="token operator">=</span>block
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Server: WEBrick/1.6.0 <span class="token punctuation">(</span>Ruby/2.7.0/2019-12-25<span class="token punctuation">)</span>
Date: Thu, <span class="token number">14</span> May <span class="token number">2020</span> 08:22:01 GMT
Connection: Keep-Alive

<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;louis&quot;</span>,<span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;online&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># Version: 0.0.1</span>
<span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>20.04
<span class="token keyword">MAINTAINER</span> Louis <span class="token string">&quot;louis.tianlu@gmail.com&quot;</span>
<span class="token keyword">ENV</span> REFRESHED_AT 2020<span class="token punctuation">-</span>05<span class="token punctuation">-</span>14

<span class="token keyword">RUN</span> sed <span class="token punctuation">-</span>i s@/security.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list
<span class="token keyword">RUN</span> sed <span class="token punctuation">-</span>i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list
<span class="token keyword">RUN</span> apt update <span class="token punctuation">-</span>y
<span class="token keyword">RUN</span> apt install <span class="token punctuation">-</span>y ruby ruby<span class="token punctuation">-</span>dev build<span class="token punctuation">-</span>essential redis<span class="token punctuation">-</span>tools
<span class="token keyword">RUN</span> gem install <span class="token punctuation">-</span><span class="token punctuation">-</span>no<span class="token punctuation">-</span>document sinatra json redis

<span class="token keyword">RUN</span> mkdir <span class="token punctuation">-</span>p /opt/webapp

<span class="token keyword">EXPOSE</span> 4567

<span class="token keyword">CMD</span> <span class="token punctuation">[</span> <span class="token string">&quot;/opt/webapp/bin/webapp&quot;</span> <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="æ„å»º-redis-é•œåƒä¸å®¹å™¨"><a href="#æ„å»º-redis-é•œåƒä¸å®¹å™¨" class="header-anchor">#</a> æ„å»º redis é•œåƒä¸å®¹å™¨</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>louis@louis redis<span class="token punctuation">]</span>$ tree
<span class="token builtin class-name">.</span>
`-- Dockerfile

<span class="token function">sudo</span> docker build -t louistian/redis <span class="token builtin class-name">.</span>
<span class="token comment"># æ·»åŠ  --protected-mode no å¦åˆ™æµ‹è¯•æ—¶è¿æ¥åä¸èƒ½æ“ä½œ</span>
<span class="token function">sudo</span> docker run -d -p <span class="token number">6379</span> --name redis louistian/redis --protected-mode no

<span class="token comment"># å¯ä»¥åœ¨å®¿ä¸»æœºè¿æ¥æµ‹è¯•</span>
redis-cli -h <span class="token number">127.0</span>.0.1 -p PORT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment"># Version: 0.0.1</span>
<span class="token keyword">FROM</span> ubuntu<span class="token punctuation">:</span>18.04
<span class="token keyword">LABEL</span> maintainer=<span class="token string">&quot;louis.tianlu@gmail.com&quot;</span>
<span class="token keyword">ENV</span> REFRESHED_AT 2020<span class="token punctuation">-</span>05<span class="token punctuation">-</span>14

<span class="token keyword">RUN</span> sed <span class="token punctuation">-</span>i s@/security.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list
<span class="token keyword">RUN</span> sed <span class="token punctuation">-</span>i s@/archive.ubuntu.com/@/mirrors.aliyun.com/@g /etc/apt/sources.list
<span class="token keyword">RUN</span> apt update <span class="token punctuation">-</span>y
<span class="token keyword">RUN</span> apt install <span class="token punctuation">-</span>y redis<span class="token punctuation">-</span>server redis<span class="token punctuation">-</span>tools

<span class="token keyword">EXPOSE</span> 6379

<span class="token keyword">ENTRYPOINT</span> <span class="token punctuation">[</span><span class="token string">&quot;/usr/bin/redis-server&quot;</span><span class="token punctuation">]</span>

<span class="token keyword">CMD</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li><p>docker è‡ªå·±çš„ç½‘ç»œæ ˆ</p> <ul><li><p>docker å®¹å™¨å…¬å¼€ç«¯å£å¹¶ç»‘å®šåˆ°æœ¬åœ°ç½‘ç»œæ¥å£, è¿™æ ·å¯ä»¥æŠŠå®¹å™¨é‡Œçš„æœåŠ¡åœ¨æœ¬åœ°å®¿ä¸»æœºæ‰€åœ¨çš„å¤–éƒ¨ç½‘ç»œ
ä¸Šå…¬å¼€</p></li> <li><p>å†…éƒ¨ç½‘ç»œ</p> <ul><li>docker0
<ul><li>è™šæ‹Ÿçš„ä»¥å¤ªç½‘æ¡¥, ç”¨äºè¿æ¥å®¹å™¨å’Œæœ¬åœ°å®¿ä¸»ç½‘ç»œ</li></ul></li> <li>veth*
<ul><li>å®¹å™¨åˆ›å»ºæ—¶ä¼šåˆ›å»ºä¸€ç»„äº’è”çš„ç½‘ç»œæ¥å£. æ¥å£å…¶ä¸­ä¸€ç«¯ä½œä¸ºå®¹å™¨é‡Œçš„ eth0 æ¥å£, å¦ä¸€ç«¯ç»Ÿä¸€å‘½
åä¸º veth*, ä½œä¸ºå®¿ä¸»æœºçš„ä¸€ä¸ªç«¯å£</li> <li>æ¯ä¸ª veth* æ¥å£éƒ½ç»‘å®šåˆ° docker0 ç½‘æ¡¥, ç”±æ­¤åˆ›å»ºä¸€ä¸ªç”±å®¿ä¸»æœºå’Œæ‰€æœ‰å®¹å™¨å…±äº«çš„è™šæ‹Ÿå­ç½‘</li></ul></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># å®¿ä¸»æœº</span>
<span class="token comment"># docker0 è™šæ‹Ÿç½‘æ¡¥</span>
<span class="token punctuation">[</span>louis@louis redis<span class="token punctuation">]</span>$ <span class="token function">ifconfig</span>
docker0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet <span class="token number">172.18</span>.0.1  netmask <span class="token number">255.255</span>.0.0  broadcast <span class="token number">172.18</span>.255.255
        inet6 fe80::42:faff:fe65:fc0  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">&gt;</span>
        ether 02:42:fa:65:0f:c0  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">76935</span>  bytes <span class="token number">4351084</span> <span class="token punctuation">(</span><span class="token number">4.1</span> MiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">172917</span>  bytes <span class="token number">1111531538</span> <span class="token punctuation">(</span><span class="token number">1.0</span> GiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

eth0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet <span class="token number">172.17</span>.0.2  netmask <span class="token number">255.255</span>.240.0  broadcast <span class="token number">172.17</span>.15.255
        inet6 fe80::5054:ff:fe1d:9861  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">&gt;</span>
        ether <span class="token number">52</span>:54:00:1d:98:61  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">2232356</span>  bytes <span class="token number">1938976249</span> <span class="token punctuation">(</span><span class="token number">1.8</span> GiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">1259922</span>  bytes <span class="token number">288469632</span> <span class="token punctuation">(</span><span class="token number">275.1</span> MiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

lo: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class="token operator">&gt;</span>  mtu <span class="token number">65536</span>
        inet <span class="token number">127.0</span>.0.1  netmask <span class="token number">255.0</span>.0.0
        inet6 ::1  prefixlen <span class="token number">128</span>  scopeid 0x1<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>host<span class="token operator">&gt;</span>
        loop  txqueuelen <span class="token number">1</span>  <span class="token punctuation">(</span>Local Loopback<span class="token punctuation">)</span>
        RX packets <span class="token number">213</span>  bytes <span class="token number">34695</span> <span class="token punctuation">(</span><span class="token number">33.8</span> KiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">213</span>  bytes <span class="token number">34695</span> <span class="token punctuation">(</span><span class="token number">33.8</span> KiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

veth36ad046: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet6 fe80::c434:a4ff:fe9a:e233  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">&gt;</span>
        ether c6:34:a4:9a:e2:33  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">7</span>  bytes <span class="token number">578</span> <span class="token punctuation">(</span><span class="token number">578.0</span> B<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

vethb6c2a94: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet6 fe80::68b3:89ff:fe9a:6296  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">&gt;</span>
        ether 6a:b3:89:9a:62:96  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">10</span>  bytes <span class="token number">828</span> <span class="token punctuation">(</span><span class="token number">828.0</span> B<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

<span class="token comment"># å®¹å™¨</span>
<span class="token comment"># docker ä¸ºå®¹å™¨åˆ†é…äº† IP 172.18.0.3</span>
root@cb9492edd6b6:/<span class="token comment"># ifconfig</span>
eth0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet <span class="token number">172.18</span>.0.3  netmask <span class="token number">255.255</span>.0.0  broadcast <span class="token number">172.18</span>.255.255
        ether 02:42:ac:12:00:03  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">6639</span>  bytes <span class="token number">31259333</span> <span class="token punctuation">(</span><span class="token number">31.2</span> MB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">760</span>  bytes <span class="token number">50193</span> <span class="token punctuation">(</span><span class="token number">50.1</span> KB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

lo: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">7</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class="token operator">&gt;</span>  mtu <span class="token number">65536</span>
        inet <span class="token number">127.0</span>.0.1  netmask <span class="token number">255.0</span>.0.0
        loop  txqueuelen <span class="token number">1</span>  <span class="token punctuation">(</span>Local Loopback<span class="token punctuation">)</span>
        RX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">0</span>  bytes <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> B<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

<span class="token comment"># å®¹å™¨è®¿é—®å¤–ç½‘, ç¬¬ä¸€è·³å°±æ˜¯å®¿ä¸»æœºç½‘ç»œä¸Šçš„ docker0 æ¥å£çš„ç½‘å…³ IP</span>
root@cb9492edd6b6:/<span class="token comment"># traceroute www.baidu.com</span>
<span class="token function">traceroute</span> to www.baidu.com <span class="token punctuation">(</span><span class="token number">180.101</span>.49.11<span class="token punctuation">)</span>, <span class="token number">30</span> hops max, <span class="token number">60</span> byte packets
<span class="token number">1</span>  <span class="token number">172.18</span>.0.1 <span class="token punctuation">(</span><span class="token number">172.18</span>.0.1<span class="token punctuation">)</span>  <span class="token number">0.028</span> ms  <span class="token number">0.011</span> ms  <span class="token number">0.009</span> ms
<span class="token number">2</span>  * <span class="token number">100.105</span>.105.130 <span class="token punctuation">(</span><span class="token number">100.105</span>.105.130<span class="token punctuation">)</span>  <span class="token number">2.081</span> ms  <span class="token number">2.970</span> ms
<span class="token number">3</span>  * <span class="token number">100.104</span>.251.210 <span class="token punctuation">(</span><span class="token number">100.104</span>.251.210<span class="token punctuation">)</span>  <span class="token number">0.643</span> ms *
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div></li></ul></li> <li><p>è¿æ¥ redis</p> <ul><li><p>é€šè¿‡æ˜ å°„åˆ°å®¿ä¸»æœºçš„ PORT</p></li> <li><p>ç›´æ¥ä½¿ç”¨è™šæ‹Ÿå­ç½‘ IP PORT</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>louis@louis redis<span class="token punctuation">]</span>$ <span class="token function">sudo</span> docker inspect redis
<span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;NetworkSettings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
          <span class="token string">&quot;Bridge&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
          <span class="token string">&quot;SandboxID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;868e968ad8ca579357c716c6f6786651c8a1c00efda93f15f7c151a416902d0b&quot;</span>,
          <span class="token string">&quot;HairpinMode&quot;</span><span class="token builtin class-name">:</span> false,
          <span class="token string">&quot;LinkLocalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
          <span class="token string">&quot;LinkLocalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
          <span class="token string">&quot;Ports&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;6379/tcp&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
                  <span class="token punctuation">{</span>
                      <span class="token string">&quot;HostIp&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0.0.0.0&quot;</span>,
                      <span class="token string">&quot;HostPort&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;32786&quot;</span>
                  <span class="token punctuation">}</span>
              <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>,
          <span class="token string">&quot;SandboxKey&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/run/docker/netns/868e968ad8ca&quot;</span>,
          <span class="token string">&quot;SecondaryIPAddresses&quot;</span><span class="token builtin class-name">:</span> null,
          <span class="token string">&quot;SecondaryIPv6Addresses&quot;</span><span class="token builtin class-name">:</span> null,
          <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;3ccba82cda80d3f56e545182d779e4b91c3e905ef03d57c5c17a4f83b582d0fa&quot;</span>,
          <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.18.0.1&quot;</span>,
          <span class="token string">&quot;GlobalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
          <span class="token string">&quot;GlobalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
          <span class="token string">&quot;IPAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.18.0.2&quot;</span>,
          <span class="token string">&quot;IPPrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
          <span class="token string">&quot;IPv6Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
          <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:ac:12:00:02&quot;</span>,
          <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
              <span class="token string">&quot;bridge&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                  <span class="token string">&quot;IPAMConfig&quot;</span><span class="token builtin class-name">:</span> null,
                  <span class="token string">&quot;Links&quot;</span><span class="token builtin class-name">:</span> null,
                  <span class="token string">&quot;Aliases&quot;</span><span class="token builtin class-name">:</span> null,
                  <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;7e1e523b599001e0d6b924e457ece4e960ab73aee50bac5f27e5763066570839&quot;</span>,
                  <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;3ccba82cda80d3f56e545182d779e4b91c3e905ef03d57c5c17a4f83b582d0fa&quot;</span>,
                  <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.18.0.1&quot;</span>,
                  <span class="token string">&quot;IPAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.18.0.2&quot;</span>,
                  <span class="token string">&quot;IPPrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
                  <span class="token string">&quot;IPv6Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                  <span class="token string">&quot;GlobalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                  <span class="token string">&quot;GlobalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
                  <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:ac:12:00:02&quot;</span>,
                  <span class="token string">&quot;DriverOpts&quot;</span><span class="token builtin class-name">:</span> null
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment"># ä½¿ç”¨æ˜ å°„ PORT</span>
<span class="token punctuation">[</span>louis@louis redis<span class="token punctuation">]</span>$ redis-cli -h <span class="token number">127.0</span>.0.1 -p <span class="token number">32786</span>
<span class="token number">127.0</span>.0.1:3278<span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span>

<span class="token comment"># ç›´æ¥ä½¿ç”¨å­ç½‘ IP PORT</span>
<span class="token punctuation">[</span>louis@louis redis<span class="token punctuation">]</span>$ redis-cli -h <span class="token number">172.18</span>.0.2 -p <span class="token number">6379</span>
<span class="token number">172.18</span>.0.2:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div></li></ul></li> <li><p>å®¹å™¨äº’è¿</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ç¡®ä¿ redis å®¹å™¨å¯åŠ¨</span>
<span class="token function">sudo</span> docker run -d --name redis louistian/redis

<span class="token comment"># --link å»ºç«‹ä¸¤ä¸ªå®¹å™¨é—´çš„çˆ¶å­å…³ç³»</span>
<span class="token comment">#         redis è¦è¿æ¥çš„å®¹å™¨åç§°</span>
<span class="token comment">#         db è¿æ¥åå®¹å™¨åˆ«å</span>
<span class="token punctuation">[</span>louis@louis sinatra<span class="token punctuation">]</span>$ <span class="token function">sudo</span> docker run -p <span class="token number">4567</span> --name webapp --link redis:db -t -i -v <span class="token environment constant">$PWD</span>/webapp:/opt/webapp louistian/sinatra /bin/bash

<span class="token comment"># æŸ¥çœ‹è¿æ¥ä¿¡æ¯</span>
root@d99a012cf351:/<span class="token comment"># cat /etc/hosts</span>
<span class="token number">127.0</span>.0.1	localhost
<span class="token number">172.18</span>.0.2	db 34177ffe0f93 redis
<span class="token number">172.18</span>.0.3	d99a012cf351

root@d99a012cf351:/<span class="token comment"># env</span>
<span class="token assign-left variable">REFRESHED_AT</span><span class="token operator">=</span><span class="token number">2020</span>-05-14
<span class="token assign-left variable"><span class="token environment constant">HOSTNAME</span></span><span class="token operator">=</span>d99a012cf351
<span class="token assign-left variable"><span class="token environment constant">PWD</span></span><span class="token operator">=</span>/
<span class="token assign-left variable">DB_PORT_6379_TCP_ADDR</span><span class="token operator">=</span><span class="token number">172.18</span>.0.2
<span class="token assign-left variable">DB_PORT_6379_TCP</span><span class="token operator">=</span>tcp://172.18.0.2:6379
<span class="token assign-left variable">DB_PORT</span><span class="token operator">=</span>tcp://172.18.0.2:6379
<span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/root
<span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li> <li><p>å®¹å™¨é€šä¿¡</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># louistian/sinatra ä¸­å¯åŠ¨</span>
root@d99a012cf351:~<span class="token comment"># /opt/webapp/bin/webapp &amp;</span>

<span class="token comment"># å®¿ä¸»æœºè¯·æ±‚</span>
<span class="token punctuation">[</span>louis@louis lib<span class="token punctuation">]</span>$ <span class="token function">curl</span> -i -H <span class="token string">'Accept: application/json'</span> -d <span class="token string">'name=louis&amp;status=online'</span> http://localhost:32790/json
<span class="token comment"># æŸ¥çœ‹ redis å®¹å™¨æ•°æ®</span>
<span class="token punctuation">[</span>louis@louis lib<span class="token punctuation">]</span>$ <span class="token function">curl</span> -i http://localhost:32790/json
HTTP/1.1 <span class="token number">200</span> OK
Content-Type: text/html<span class="token punctuation">;</span><span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
Content-Length: <span class="token number">46</span>
X-Xss-Protection: <span class="token number">1</span><span class="token punctuation">;</span> <span class="token assign-left variable">mode</span><span class="token operator">=</span>block
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
Server: WEBrick/1.6.0 <span class="token punctuation">(</span>Ruby/2.7.0/2019-12-25<span class="token punctuation">)</span>
Date: Fri, <span class="token number">15</span> May <span class="token number">2020</span> 02:36:13 GMT
Connection: Keep-Alive

<span class="token string">&quot;[{<span class="token entity" title="\&quot;">\&quot;</span>name<span class="token entity" title="\&quot;">\&quot;</span>:<span class="token entity" title="\&quot;">\&quot;</span>louis<span class="token entity" title="\&quot;">\&quot;</span>,<span class="token entity" title="\&quot;">\&quot;</span>status<span class="token entity" title="\&quot;">\&quot;</span>:<span class="token entity" title="\&quot;">\&quot;</span>online<span class="token entity" title="\&quot;">\&quot;</span>}]&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># /home/louis/studio/sinatra/webapp/lib</span>
require <span class="token string">&quot;rubygems&quot;</span>
require <span class="token string">&quot;sinatra&quot;</span>
require <span class="token string">&quot;json&quot;</span>
require <span class="token string">&quot;redis&quot;</span>

class App <span class="token operator">&lt;</span> Sinatra::Application
      redis <span class="token operator">=</span> Redis.new<span class="token punctuation">(</span>:host <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'db'</span>, :port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">'6379'</span><span class="token punctuation">)</span>

      <span class="token builtin class-name">set</span> :bind, <span class="token string">'0.0.0.0'</span>

      get <span class="token string">'/'</span> <span class="token keyword">do</span>
        <span class="token string">&quot;&lt;h1&gt;DockerBook Test Redis-enabled Sinatra app&lt;/h1&gt;&quot;</span>
      end

      get <span class="token string">'/json'</span> <span class="token keyword">do</span>
        params <span class="token operator">=</span> redis.get <span class="token string">&quot;params&quot;</span>
        params.to_json
      end

      post <span class="token string">'/json/?'</span> <span class="token keyword">do</span>
        redis.set <span class="token string">&quot;params&quot;</span>, <span class="token punctuation">[</span>params<span class="token punctuation">]</span>.to_json
        params.to_json
      end
end
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li></ul> <blockquote><p>! docker å­¦ä¹ æš‚æ—¶å‘Šä¸€æ®µè½, æ¥ä¸‹æ¥å†…å®¹ä¸»è¦ä»¥åº”ç”¨ä¸ºä¸»</p></blockquote></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/louistin/blog.liteman/edit/master/docs/note/ç¬¬ä¸€æœ¬ Docker ä¹¦.md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">æœ€è¿‘æ›´æ–°:</span> <span class="time">2020-05-29 14:46:16 UTC+08:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/note/MySQL å¿…çŸ¥å¿…ä¼š.html" class="prev">
        MySQL å¿…çŸ¥å¿…ä¼š
      </a></span> <!----></p></div> </main></div><div class="global-ui"><div class="reading-progress top" data-v-21b39eda><div class="progress" data-v-21b39eda></div></div><!----></div></div>
    <script src="/assets/js/app.5aa78949.js" defer></script><script src="/assets/js/2.db8a1bd9.js" defer></script><script src="/assets/js/36.4c9eea64.js" defer></script>
  </body>
</html>
